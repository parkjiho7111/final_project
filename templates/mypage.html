<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë§ˆì´í˜ì´ì§€ | ì²­ë…„ ì •ì±… í”Œë«í¼</title>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">

    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/style.css">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-orange': '#F48245',
                        'primary-teal': '#4A9EA8',
                        'primary-beige': '#D9B36C',
                        'primary-red': '#FF5A5F',
                        'bg-light': '#FFFFFF',
                        'text-main': '#000000',
                    },
                    fontFamily: {
                        sans: ['Pretendard', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        /* #mypage-list ë‚´ë¶€ì˜ ëª¨ë“  ìš”ì†Œì— ëŒ€í•´ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ ë¬´íš¨í™” */
        #mypage-list .policy-card,
        #mypage-list .policy-card * {
            /* GSAPì´ opacityë¥¼ 0ìœ¼ë¡œ ë§Œë“¤ì–´ë„ ê°•ì œë¡œ 1ë¡œ ê³ ì • */
            opacity: 1 !important;

            /* GSAPì´ ìœ„ì¹˜ë¥¼ ì´ë™(translate)ì‹œì¼œë„ ê°•ì œë¡œ ì œìë¦¬ ê³ ì • */
            transform: none !important;

            /* GSAPì´ ìˆ¨ê¹€ ì²˜ë¦¬(visibility)í•´ë„ ê°•ì œë¡œ ë³´ì´ê²Œ í•¨ */
            visibility: visible !important;

            /* ëª¨ë“  íŠ¸ëœì§€ì…˜ íš¨ê³¼ ì œê±° */
            transition: none !important;
        }

        .header-text h1,
        .header-text p {
            opacity: 0;
            visibility: hidden;
            transform: translateY(30px);
            will-change: transform, opacity;
        }

        .header-text {
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .bg-aurora {
            background-color: #111827;
            position: relative;
            overflow: hidden;
        }

        .bg-aurora::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(94, 234, 212, 0.25) 0%, transparent 50%);
            animation: aurora-rotate 15s linear infinite;
            pointer-events: none;
        }

        .bg-aurora::after {
            content: '';
            position: absolute;
            bottom: -30%;
            right: -30%;
            width: 150%;
            height: 150%;
            background: radial-gradient(circle, rgba(94, 234, 212, 0.15) 0%, transparent 60%);
            animation: aurora-pulse 8s infinite alternate ease-in-out;
            pointer-events: none;
        }

        @keyframes aurora-rotate {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes aurora-pulse {
            0% {
                transform: scale(1);
            }

            100% {
                transform: scale(1.2);
            }
        }

        #mbti-modal {
            transition: opacity 0.3s ease;
        }

        #mbti-modal.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .aurora-layer-dark {
            position: absolute;
            inset: 0;
            z-index: 0;
            overflow: hidden;
            background: #1a1a2e;
        }

        :root {
            --aurora-point: #6CD984;
        }

        .aurora-blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(90px);
            opacity: 0.6;
            mix-blend-mode: screen;
            animation: blob-move 8s infinite alternate ease-in-out;
        }

        .blob-1 {
            top: -20%;
            left: -20%;
            width: 80%;
            height: 80%;
            background: var(--aurora-point);
        }

        .blob-2 {
            bottom: -20%;
            right: -20%;
            width: 90%;
            height: 90%;
            background: var(--aurora-point);
            animation-duration: 12s;
            opacity: 0.4;
        }

        .blob-3 {
            top: 40%;
            left: 40%;
            width: 50%;
            height: 50%;
            background: #ffffff;
            animation-duration: 10s;
            opacity: 0.15;
        }

        @keyframes blob-move {
            from {
                transform: translate(-30px, -30px) scale(1);
            }

            to {
                transform: translate(60px, 60px) scale(1.2);
            }
        }

        .result-card-enter {
            animation: slideUpFadeIn 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes slideUpFadeIn {
            from {
                opacity: 0;
                transform: translateY(40px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .typing-cursor::after {
            content: '|';
            display: inline-block;
            margin-left: 4px;
            animation: blink 0.7s infinite;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }
        }
    </style>
</head>

<body class="font-sans antialiased bg-[#f9fafb]">

    {% include "nav.html" %}
    <main class="body-container mypage-container max-w-[1200px] mx-auto px-5 py-10">
        <section class="w-full mb-12 pt-4 flex flex-col md:flex-row items-center justify-between gap-10">
            <div class="flex-1 text-center md:text-left header-text items-center md:items-start">
                <div
                    class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-orange-50 text-primary-orange text-xs font-bold mb-6">
                    <span>My Analytics</span>
                    <i class="fa-solid fa-star text-[10px]"></i>
                </div>
                <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 leading-tight mb-6">
                    ë‚˜ì˜ ì •ì±… í™œë™<br>
                    <span class="relative inline-block z-10">
                        í•œëˆˆì— ëª¨ì•„ë³´ê¸° ğŸ“Š
                        <span class="absolute bottom-1 left-0 w-full h-3 bg-orange-100 -z-10 rounded-sm"></span>
                    </span>
                </h1>
                <p class="text-gray-500 text-lg leading-relaxed">
                    ë‚´ê°€ ì°œí•œ ì •ì±…ê³¼ ê´€ì‹¬ì‚¬ ë°ì´í„°ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.<br>
                    ë‚˜ë§Œì˜ ë§ì¶¤í˜• ì •ì±… ë¼ì´í”„ê°€ ì‹œì‘ë©ë‹ˆë‹¤.
                </p>
            </div>
            <div class="flex-1 flex justify-center md:justify-end relative header-image">
                <div
                    class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[400px] h-[400px] bg-orange-50 rounded-full blur-3xl -z-10 opacity-60">
                </div>
                <img src="/static/images/header2_image.png"
                    onerror="this.src='https://placehold.co/500x400/transparent/orange?text=Main+Banner'"
                    class="w-full max-w-[450px] object-contain drop-shadow-sm hover:scale-105 transition-transform duration-500"
                    alt="Header Banner">
            </div>
        </section>

        <div class="w-full h-[1px] bg-gray-100 mb-12"></div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 auto-rows-[minmax(180px,auto)]">
            <div onclick="openMbtiModal()"
                class="bg-aurora group relative col-span-1 h-[320px] rounded-[40px] overflow-hidden shadow-md cursor-pointer transition-all hover:-translate-y-2 hover:shadow-2xl border border-white/5">
                <div class="relative z-10 h-full flex flex-col p-8 text-white">
                    <h2 class="text-3xl font-bold leading-tight mb-2 drop-shadow-md">
                        ë‚˜ì˜ ì •ì±…<br><span class="text-[#5EEAD4] drop-shadow-[0_0_12px_rgba(94,234,212,0.6)]">MBTIëŠ”?</span>
                    </h2>
                    <p class="text-gray-300 text-sm font-medium mt-2">ë‚´ ì„±í–¥ ë¶„ì„í•˜ê³ <br>ë”± ë§ëŠ” ì§€ì›ë°›ê¸°</p>
                    <div
                        class="mt-auto flex items-center gap-2 text-gray-300 text-sm font-bold group-hover:text-white transition-colors">
                        <span>Tap to view</span>
                        <i
                            class="fa-solid fa-arrow-right animate-pulse text-[#5EEAD4] drop-shadow-[0_0_8px_rgba(94,234,212,0.8)]"></i>
                    </div>
                </div>
                <img src="/static/images/membership_image.png"
                    onerror="this.src='https://placehold.co/300x300/transparent/ffffff?text=MBTI'"
                    class="absolute right-[-40px] bottom-[-30px] w-64 h-64 object-contain transition-transform duration-500 group-hover:scale-110 opacity-80 mix-blend-lighten">
            </div>

            <div
                class="col-span-1 h-[320px] rounded-[40px] bg-white p-8 shadow-sm border border-gray-100 flex flex-col justify-center">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-xl text-gray-800">ê´€ì‹¬ í‚¤ì›Œë“œ íŠ¸ë Œë“œ ğŸ“ˆ</h3>
                    <button class="text-gray-400 hover:text-gray-600"><i class="fa-solid fa-ellipsis"></i></button>
                </div>
                <div class="w-full h-full flex justify-center items-center"><canvas id="myChart"></canvas></div>
            </div>

            <div
                class="col-span-1 rounded-[30px] bg-white p-8 shadow-sm border border-gray-100 flex items-center justify-between relative overflow-hidden group hover:border-orange-200 transition-colors">
                <div class="absolute right-0 top-0 w-24 h-full bg-gradient-to-l from-orange-50 to-transparent"></div>
                <div class="flex items-center gap-6 relative z-10">
                    <div class="relative">
                        <img src="https://placehold.co/120x120/F48245/ffffff?text=User" alt="Profile"
                            class="w-24 h-24 rounded-full border-4 border-orange-50 shadow-sm object-cover group-hover:scale-105 transition-transform">
                        <button
                            class="absolute bottom-0 right-0 bg-gray-900 text-white w-8 h-8 rounded-full shadow-md hover:bg-primary-orange transition-colors flex items-center justify-center"><i
                                class="fa-solid fa-pen text-xs"></i></button>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-gray-900 mb-1">ê¹€ì²­ë…„ ë‹˜ ğŸ‘‹</h2>
                        <p class="text-gray-500 text-sm mb-3">youth_kim@example.com</p>
                        <div class="flex gap-2">
                            <span class="px-3 py-1 bg-gray-100 text-gray-600 text-xs font-bold rounded-lg">#ì„œìš¸ì‹œ</span>
                            <span class="px-3 py-1 bg-gray-100 text-gray-600 text-xs font-bold rounded-lg">#ì·¨ì—…ì¤€ë¹„</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-span-1 grid grid-cols-2 gap-4">
                <div
                    class="col-span-2 sm:col-span-1 rounded-[30px] bg-[#FDF8F3] p-6 shadow-sm border border-orange-100 flex flex-col justify-center hover:shadow-md transition-shadow">
                    <p class="text-sm text-primary-orange font-bold mb-1">ë‚˜ì˜ í™œë™ ì§€ìˆ˜</p>
                    <p class="text-xl font-bold text-gray-800">ìƒìœ„ 15% ğŸ”¥</p>
                    <div class="w-full bg-orange-100 h-2 rounded-full mt-3 overflow-hidden">
                        <div class="bg-primary-orange h-full rounded-full" style="width: 85%"></div>
                    </div>
                </div>
                <div
                    class="col-span-2 sm:col-span-1 bg-white rounded-[30px] p-6 shadow-sm border border-gray-100 flex justify-around items-center group hover:border-orange-200 transition-colors">
                    <div class="text-center">
                        <div class="text-gray-300 text-2xl mb-1 transition-colors group-hover:text-primary-red"><i
                                class="fa-solid fa-heart"></i></div>
                        <p class="text-xs text-gray-400 font-bold mb-1">ì°œí•œ ì •ì±…</p>
                        <p class="text-xl font-extrabold text-gray-800">12</p>
                    </div>
                    <div class="w-[1px] h-12 bg-gray-100"></div>
                    <div class="text-center">
                        <div class="text-gray-300 text-2xl mb-1 transition-colors group-hover:text-primary-teal"><i
                                class="fa-solid fa-paper-plane"></i></div>
                        <p class="text-xs text-gray-400 font-bold mb-1">ì‹ ì²­ ì™„ë£Œ</p>
                        <p class="text-xl font-extrabold text-gray-800">3</p>
                    </div>
                </div>
            </div>
    </main>
    <main class="body-container mypage-container max-w-[1200px] mx-auto px-5 py-10">
        <div class="col-span-1 md:col-span-2 mt-4">
            <div class="flex justify-between items-center mb-6 px-2">
                <h3 class="font-bold text-2xl">ë‚´ê°€ ì°œí•œ ì •ì±… â¤ï¸</h3>
                <a href="#"
                    class="text-sm text-gray-500 hover:text-black font-medium underline decoration-gray-300 underline-offset-4">ëª¨ë‘
                    ë³´ê¸°</a>
            </div>
            <div id="mypage-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6"></div>
        </div>
    </main>

    <div id="mbti-modal" class="fixed inset-0 z-[9999] flex items-center justify-center hidden">
        <div class="aurora-layer-dark">
            <div class="aurora-blob blob-1"></div>
            <div class="aurora-blob blob-2"></div>
            <div class="aurora-blob blob-3"></div>
            <div class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
        </div>

        <div id="mbti-card"
            class="relative z-10 w-full h-full md:h-auto md:max-w-md bg-white/10 backdrop-blur-xl md:rounded-3xl overflow-hidden shadow-2xl border border-white/10 flex flex-col p-8 text-white">
            <button onclick="closeMbtiModal()"
                class="absolute top-6 right-6 text-white/50 hover:text-white transition-colors p-2 z-50">
                <i class="fa-solid fa-xmark text-2xl"></i>
            </button>

            <div id="mbti-loading" class="flex-1 flex flex-col items-center justify-center text-center space-y-8">
                <div class="w-32 h-32" id="loading-lottie"></div>
                <h3 class="text-2xl font-bold leading-snug typing-cursor text-white" id="loading-text">ë¶„ì„ ì¤‘...</h3>
            </div>

            <div id="mbti-result"
                class="hidden flex-1 flex flex-col items-center justify-center text-center gap-5 opacity-0">
                <div>
                    <p class="text-sm font-medium text-white/70 mb-2">ë‚˜ì˜ ì •ì±… ì„±í–¥ì€?</p>
                    <h2 id="result-title"
                        class="text-xl md:text-2xl font-extrabold mb-1 text-transparent bg-clip-text bg-gradient-to-r from-white to-gray-200">
                        ë¹„ì „ì„ ì¢‡ëŠ” ì—´ì • ê°œì²™ì
                    </h2>
                    <h1 id="result-type"
                        class="text-3xl md:text-4xl font-black tracking-widest text-white drop-shadow-[0_0_15px_rgba(255,255,255,0.3)]">
                        ì·¨ì—…/ì§ë¬´
                    </h1>
                </div>

                <div
                    class="w-full aspect-[4/3] relative rounded-[24px] overflow-hidden shadow-2xl border border-white/10 group bg-gray-900">
                    <div
                        class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent z-10 pointer-events-none">
                    </div>
                    <img id="result-img" src="/static/images/dummy_result_mbti.png" alt="MBTI Result"
                        class="w-full h-full object-cover transform transition-transform duration-700 group-hover:scale-105">
                </div>

                <div id="result-tags" class="flex flex-wrap justify-center items-center gap-2"></div>

                <div class="w-full mt-2">
                    <button onclick="shareMbtiImage()"
                        class="w-full py-4 bg-white text-black hover:bg-gray-100 rounded-xl font-bold text-lg transition-all shadow-lg hover:-translate-y-1 flex items-center justify-center gap-2">
                        <i class="fa-solid fa-download"></i> ê²°ê³¼ ì¹´ë“œ ì´ë¯¸ì§€ ì €ì¥í•˜ê¸°
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="export-template"
        style="position: fixed; left: -9999px; top: 0; width: 600px; height: 800px; background-color: #111827; z-index: -1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px; box-sizing: border-box; font-family: 'Pretendard', sans-serif;">
        <div
            style="position: relative; z-index: 10; text-align: center; width: 100%; display: flex; flex-direction: column; align-items: center; gap: 20px;">
            <p style="font-size: 18px; color: rgba(255,255,255,0.7); margin: 0; font-weight: 500;">ë‚˜ì˜ ì •ì±… ì„±í–¥ì€?</p>

            <h2 id="export-title" style="font-size: 32px; font-weight: 800; color: #ffffff; margin: 0;">
                ë¹„ì „ì„ ì¢‡ëŠ” ì—´ì • ê°œì²™ì
            </h2>

            <h1 id="export-type"
                style="font-size: 56px; font-weight: 900; color: #ffffff; letter-spacing: 2px; margin: 0;">
                ì·¨ì—…/ì§ë¬´
            </h1>

            <div
                style="width: 480px; height: 360px; border-radius: 32px; overflow: hidden; margin: 20px 0; box-shadow: 0 20px 50px rgba(0,0,0,0.5); position: relative;">
                <img id="export-img" src="/static/images/dummy_result_mbti.png"
                    style="width: 100%; height: 100%; object-fit: cover;">
            </div>

            <div id="export-tags" style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;"></div>

            <div style="margin-top: 40px; opacity: 0.5;">
                <img src="/static/images/logo.svg" style="height: 30px; filter: invert(1) brightness(200%);"
                    onerror="this.style.display='none'">
                <p style="color: #fff; font-size: 14px; margin-top: 5px; font-weight: bold;">ì“±ì“± ì •ì±… í”Œë«í¼</p>
            </div>
        </div>
    </div>

    <script src="/static/script.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            if (window.playHeaderAnimation) setTimeout(() => { window.playHeaderAnimation(); }, 100);

            const MBTI_TYPES = {
                'edu': { title: 'ğŸ“ ëŠì„ì—†ì´ ì„±ì¥í•˜ëŠ” ì§€ì‹ íƒí—˜ê°€', type: 'êµìœ¡/ìê²©ì¦', color: '#4A9EA8', tags: ['#ìê¸°ê°œë°œ', '#ìê²©ì¦ì·¨ë“', '#í‰ìƒí•™ìŠµ'] },
                'housing': { title: 'ğŸ¡ ë¡œë§ì„ ì‹¤í˜„í•˜ëŠ” ê³µê°„ ì„¤ê³„ì', type: 'ì£¼ê±°/ìë¦½', color: '#F48245', tags: ['#ë…ë¦½ìƒí™œ', '#ì£¼ê±°ì•ˆì •', '#ë‚´ì§‘ë§ˆë ¨'] },
                'finance': { title: 'ğŸ’° ë¹ˆí‹ˆì—†ì´ ê³„íší•˜ëŠ” ìì‚° ì „ëµê°€', type: 'ê¸ˆìœµ/ìƒí™œë¹„', color: '#D9B36C', tags: ['#ëª©ëˆë§ˆë ¨', '#ì¬í…Œí¬', '#í•©ë¦¬ì ì†Œë¹„'] },
                'welfare': { title: 'ğŸ€ ì¼ìƒì„ ì¦ê¸°ëŠ” ë‚­ë§Œ ìˆ˜ì§‘ê°€', type: 'ë³µì§€/ë¬¸í™”', color: '#614AA8', tags: ['#ì›Œë¼ë°¸', '#ë¬¸í™”ìƒí™œ', '#ì‹¬ë¦¬ì•ˆì •'] },
                'job': { title: 'ğŸ’¼ ë¹„ì „ì„ ì¢‡ëŠ” ì—´ì • ê°œì²™ì', type: 'ì·¨ì—…/ì§ë¬´', color: '#6CD984', tags: ['#ì»¤ë¦¬ì–´ì„±ì¥', '#ì§ë¬´ì „ë¬¸ì„±', '#ë„ì „'] },
                'startup': { title: 'ğŸš€ ì„¸ìƒì„ ë°”ê¾¸ëŠ” í˜ì‹  ë¦¬ë”', type: 'ì°½ì—…/ì‚¬ì—…', color: '#FF4343', tags: ['#ì°½ì—…ë„ì „', '#í˜ì‹ ì•„ì´ë””ì–´', '#CEO'] }
            };

            const CURRENT_RESULT_KEY = 'job';

            const mbtiModal = document.getElementById('mbti-modal');
            const mbtiLoading = document.getElementById('mbti-loading');
            const mbtiResult = document.getElementById('mbti-result');
            const loadingText = document.getElementById('loading-text');

            const resultTitle = document.getElementById('result-title');
            const resultType = document.getElementById('result-type');
            const resultTags = document.getElementById('result-tags');

            let loadingAnimation = null;

            function initLoadingLottie() {
                if (loadingAnimation) return;
                const container = document.getElementById('loading-lottie');
                if (!container) return;
                const LOTTIE_URL = 'https://lottie.host/9e1205c4-42f0-496a-8b83-8a033284f23b/D0kQj2w6zB.json';
                try {
                    loadingAnimation = lottie.loadAnimation({
                        container: container, renderer: 'svg', loop: true, autoplay: false, path: LOTTIE_URL
                    });
                } catch (e) { container.innerHTML = "Loading..."; }
            }

            function typeWriter(text, element, speed = 100) {
                element.innerText = "";
                let i = 0;
                function type() {
                    if (i < text.length) { element.innerText += text.charAt(i); i++; setTimeout(type, speed); }
                    else { element.classList.remove('typing-cursor'); }
                }
                element.classList.add('typing-cursor');
                type();
            }

            function setMbtiResult(key) {
                const data = MBTI_TYPES[key];
                if (!data) return;

                resultTitle.innerText = data.title;
                resultType.innerText = data.type;
                resultTags.innerHTML = data.tags.map(tag =>
                    `<span class="px-3 py-1.5 bg-white/20 rounded-full text-sm font-bold backdrop-blur-sm border border-white/10 shadow-sm flex items-center justify-center">${tag}</span>`
                ).join('');
                document.documentElement.style.setProperty('--aurora-point', data.color);

                document.getElementById('export-title').innerText = data.title;
                document.getElementById('export-type').innerText = data.type;

                // [ìˆ˜ì •: Flex ì •ë ¬ + Line-height ë³´ì •ìœ¼ë¡œ ì™„ë²½í•œ ì¤‘ì•™ ì •ë ¬ êµ¬í˜„]
                // line-heightë¥¼ ë†’ì´ë³´ë‹¤ ì‚´ì§ ì‘ê²Œ ì¡ì•„ í°íŠ¸ ìì²´ì˜ í•˜ë‹¨ ì—¬ë°±ì„ ìƒì‡„
                const exportTagsContainer = document.getElementById('export-tags');
                exportTagsContainer.innerHTML = data.tags.map(tag =>
                    `<span style="display: inline-block; height: 44px; line-height: 40px; padding: 0 24px; background: rgba(255,255,255,0.2); border-radius: 50px; color: white; font-weight: bold; font-size: 16px; border: 1px solid rgba(255,255,255,0.1); text-align: center; vertical-align: middle;">${tag}</span>`
                ).join('');
            }

            window.openMbtiModal = function () {
                mbtiModal.classList.remove('hidden');
                mbtiLoading.classList.remove('hidden');
                mbtiResult.classList.add('hidden');
                mbtiResult.classList.remove('result-card-enter');
                initLoadingLottie();
                if (loadingAnimation) loadingAnimation.play();

                typeWriter("ë‘êµ¬ë‘êµ¬....", loadingText, 150);
                setMbtiResult(CURRENT_RESULT_KEY);

                setTimeout(() => { typeWriter("ë¶„ì„ ì™„ë£Œ!", loadingText, 100); }, 2000);
                setTimeout(() => {
                    if (loadingAnimation) loadingAnimation.stop();
                    gsap.to(mbtiLoading, {
                        opacity: 0, duration: 0.3,
                        onComplete: () => {
                            mbtiLoading.classList.add('hidden'); mbtiLoading.style.opacity = 1;
                            mbtiResult.classList.remove('hidden'); mbtiResult.classList.add('result-card-enter');
                        }
                    });
                }, 3500);
            };

            window.closeMbtiModal = function () {
                gsap.to(mbtiModal, {
                    opacity: 0, duration: 0.3,
                    onComplete: () => {
                        mbtiModal.classList.add('hidden'); mbtiModal.style.opacity = 1;
                        if (loadingAnimation) loadingAnimation.stop(); loadingText.innerText = "ë¶„ì„ ì¤‘...";
                    }
                });
            };

            window.shareMbtiImage = function () {
                const target = document.getElementById('export-template');
                const btn = document.querySelector('#mbti-result button');
                const originalText = btn.innerHTML;

                btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> ì´ë¯¸ì§€ ìƒì„± ì¤‘...';
                btn.disabled = true;

                const runCapture = () => {
                    html2canvas(target, {
                        scale: 2, backgroundColor: '#111827', useCORS: true
                    }).then(canvas => {
                        const link = document.createElement('a');
                        link.download = 'my_policy_mbti.png';
                        link.href = canvas.toDataURL('image/png');
                        link.click();
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                    }).catch(err => {
                        console.error(err);
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                        alert("ì´ë¯¸ì§€ ì €ì¥ ì‹¤íŒ¨");
                    });
                };

                if (typeof html2canvas !== 'undefined') {
                    runCapture();
                } else {
                    const script = document.createElement('script');
                    script.src = 'https://html2canvas.hertzen.com/dist/html2canvas.min.js';
                    script.onload = runCapture;
                    document.head.appendChild(script);
                }
            };

            initLoadingLottie();
        });
    </script>

    <!-- policy-modal -->

    {% include "components/policy_modal.html" %}

    <script src="/static/policy_modal.js"></script>

    <script>
        // [New] ì•Œë¦¼ í´ë¦­ ì‹œ ë§ˆê°ì„ë°• ì •ì±… ìë™ ì˜¤í”ˆ ë¡œì§
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const policyId = params.get('policy_id');
            const openModal = params.get('open_modal');

            if (policyId && openModal === 'true') {
                const listContainer = document.getElementById('mypage-list');
                if (!listContainer) return;

                // 1. ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆì„ ê²½ìš° (í˜¹ì‹œë‚˜)
                const existingCard = listContainer.querySelector(`.policy-card[data-id="${policyId}"]`);
                if (existingCard) {
                    openCardModal(existingCard);
                    return;
                }

                // 2. ë¹„ë™ê¸° ë¡œë“œ ëŒ€ê¸° (MutationObserver)
                const observer = new MutationObserver((mutations) => {
                    const card = listContainer.querySelector(`.policy-card[data-id="${policyId}"]`);
                    if (card) {
                        openCardModal(card);
                        observer.disconnect(); // ì°¾ì•˜ìœ¼ë©´ ê°ì‹œ ì¤‘ë‹¨
                    }
                });

                observer.observe(listContainer, { childList: true, subtree: true });

                // 3. íƒ€ì„ì•„ì›ƒ (10ì´ˆ ë’¤ ê°ì‹œ ì¤‘ë‹¨ - ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€)
                setTimeout(() => observer.disconnect(), 10000);
            }
        });
    </script>
</body>

</html>