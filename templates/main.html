<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì²­ë…„ ì •ì±… í”Œë«í¼</title>

    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/variable/pretendardvariable.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-orange': '#F48245', 'primary-teal': '#4A9EA8', 'primary-beige': '#D9B36C', 'primary-red': '#FF5A5F',
                        'bg-light': '#FFFFFF', 'text-main': '#000000',
                    },
                    fontFamily: { sans: ['"Pretendard Variable"', 'Pretendard', 'sans-serif'] }
                }
            }
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <!-- [ì¶”ê°€] no-more-cards ìœ„ì¹˜ ì¡°ì • ë° ë²„íŠ¼ ìŠ¤íƒ€ì¼ -->
    <style>
        .no-more-cards {
            top: 40% !important;
            transform: translate(-50%, -50%) !important;
        }

        .mypage-link-btn {
            padding: 8px 16px;
            background-color: #F48245;
            color: white;
            border: 1px solid #F48245;
            border-radius: 9999px;
            font-weight: bold;
            font-size: 15px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            margin-bottom: 16px;
            min-width: 200px;
            width: 200px;
        }

        .mypage-link-btn:hover {
            background-color: #ffa366;
            border-color: #ffa366;
        }

        .mypage-link-btn span {
            display: inline-flex;
            align-items: center;
        }

        .load-more-cards-btn {
            padding: 8px 16px;
            background-color: #4A9EA8;
            color: white;
            border: 1px solid #4A9EA8;
            border-radius: 9999px;
            font-weight: bold;
            font-size: 15px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            margin-bottom: 16px;
            min-width: 200px;
            width: 200px;
        }

        .load-more-cards-btn:hover {
            background-color: #6bb5c0;
            border-color: #6bb5c0;
        }

        .load-more-cards-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>

    <link rel="stylesheet" href="/static/style.css">

    <style>
        /* í…ìŠ¤íŠ¸ ì˜ì—­ ë†’ì´ ê³ ì • */
        .header-text {
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 180px;
        }

        .header-text h1,
        .header-text p {
            opacity: 0;
            visibility: hidden;
            transform: translateY(30px);
            will-change: transform, opacity;
        }

        .header-image-container {
            width: 100%;
            aspect-ratio: 16 / 9;
            min-height: 400px;
            max-height: 600px;
            position: relative;
            background-color: #f9fafb;
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .header-image-container video {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }

        #preloader {
            opacity: 1;
            visibility: visible;
            display: flex;
            transition: opacity 0.5s ease;
        }

        /* Minimal Strip Banner Style */
        .apple-banner {
            background-color: #222222;
        }

        .cycling-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body class="font-sans antialiased">

    <div id="preloader" class="fixed inset-0 z-[9999] flex items-center justify-center bg-white">
        <div id="lottie-container" class="w-40 h-40"></div>
    </div>

    {% include "nav.html" %}
    <main class="relative body-container mypage-container max-w-[1200px] mx-auto px-5 py-10">
        <section class="header-section">
            <div class="w-full flex flex-col md:flex-row items-center justify-between gap-6 lg:gap-10 mb-8">

                <div class="w-full md:w-[45%] text-center md:text-left order-1 shrink-0 px-3 py-1 header-text">
                    <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 leading-tight mb-6">
                        &nbsp;<br>&nbsp;
                    </h1>
                    <p class="text-gray-500 text-lg leading-relaxed break-keep">
                        &nbsp;<br>&nbsp;
                    </p>
                </div>

                <div class="w-full md:w-[55%] flex justify-center md:justify-end relative order-2 header-image">
                    <div class="header-image-container relative bg-white rounded-[20px] overflow-hidden">
                        <div
                            class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[120%] h-[120%] bg-orange-50 rounded-full blur-3xl -z-10 opacity-60">
                        </div>

                        <video autoplay muted loop playsinline poster="/static/images/header_poster.jpg"
                            onerror="this.poster='https://placehold.co/600x400/transparent/transparent'"
                            class="w-full h-full object-contain bg-white rounded-[20px]">
                            <source src="/static/images/header_video.mp4" type="video/mp4">
                            <source src="/static/images/header_video.webm" type="video/webm">
                        </video>
                    </div>
                </div>
            </div>

            <div class="dvline">
                <span class="dv-item pink-bullet">Smart Matching</span><span class="dv-item pink-bullet">Since
                    2025</span><span class="dv-item pink-bullet">Accessible, Reliable</span><span
                    class="dv-item pink-bullet long-text">Your Everyday Policy Mate</span>
            </div>
        </section>

        <section class="tinder-section">
            <div class="section-title">
                <h2>ì§€ê¸ˆ ì£¼ëª©í•´ì•¼ í•  ì •ì±…</h2>
                <p>ì¹´ë“œë¥¼ ì¢Œìš°ë¡œ ë„˜ê²¨ë³´ì„¸ìš” (ìŠ¤ì™€ì´í”„)</p>
            </div>
            <div class="swiper-container">
                <div class="card-stack" id="tinder-list">
                    <div class="no-more-cards">ëª¨ë“  ì¹´ë“œë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤! ğŸ‰</div>
                </div>
                <div id="swipe-guide"
                    class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-20 pointer-events-none opacity-0 flex flex-col items-center justify-center gap-4">

                    <div class="flex items-center justify-center drop-shadow-[0_4px_4px_rgba(0,0,0,0.3)]">
                        <i class="fa-solid fa-hand-pointer text-5xl text-white" id="hand-icon"></i>
                    </div>

                    <div class="drop-shadow-[0_2px_4px_rgba(0,0,0,0.6)]">
                        <p class="text-lg font-extrabold text-white whitespace-nowrap tracking-wide">
                            ì™¼ìª½: ë„˜ê¸°ê¸° ğŸ‘ˆ&nbsp;|&nbsp; ğŸ‘‰ ì˜¤ë¥¸ìª½: ì°œ â¤ï¸
                        </p>
                    </div>

                </div>
        </section>

        <section class="apple-banner-wrapper my-14 w-full px-4 md:px-0">
            <div class="apple-banner relative w-full mx-auto overflow-hidden text-white flex flex-col md:flex-row items-center justify-between 
                        gap-4 md:gap-0
                        rounded-[24px] md:rounded-[12px]
                        p-6 md:py-3 md:px-4
                        bg-[#777777]
                        transition-all duration-500 hover:border-gray-600 shadow-lg group">

                <div class="flex-shrink-0 z-10">
                    <div
                        class="relative w-[48px] h-[48px] rounded-full bg-[#f4f4f4] flex items-center justify-center overflow-hidden">
                        <div class="cycling-icon absolute opacity-0 text-xl text-primary-orange" data-text="ì·¨ì—…/ì§ë¬´ë¥¼">
                            <i class="fa-solid fa-briefcase"></i>
                        </div>
                        <div class="cycling-icon absolute opacity-0 text-xl text-blue-500" data-text="ì°½ì—…/ì‚¬ì—…ì„">
                            <i class="fa-solid fa-rocket"></i>
                        </div>
                        <div class="cycling-icon absolute opacity-0 text-xl text-primary-teal" data-text="ì£¼ê±°/ìë¦½ì„">
                            <i class="fa-solid fa-house-chimney"></i>
                        </div>
                        <div class="cycling-icon absolute opacity-0 text-xl text-primary-beige" data-text="ê¸ˆìœµ/ìƒí™œë¹„ë¥¼">
                            <i class="fa-solid fa-coins"></i>
                        </div>
                        <div class="cycling-icon absolute opacity-0 text-xl text-[#A8A29E]" data-text="êµìœ¡/ìê²©ì¦ì„">
                            <i class="fa-solid fa-graduation-cap"></i>
                        </div>
                        <div class="cycling-icon absolute opacity-0 text-xl text-primary-red" data-text="ë³µì§€/ë¬¸í™”ë¥¼">
                            <i class="fa-solid fa-hand-holding-heart"></i>
                        </div>
                    </div>
                </div>

                <div class="flex-1 text-center px-4 z-10">
                    <h2 class="text-[15px] font-bold text-gray-200 tracking-tight m-0">
                        ì²­ë…„ ì •ì±…ì˜
                        <span id="banner-keyword"
                            class="text-[#fcaa2f] inline-block min-w-[100px] transition-colors duration-300">
                            6ê°€ì§€ í•µì‹¬ ë¶„ì•¼ë¥¼
                        </span>
                        í™•ì¸í•˜ì„¸ìš”
                    </h2>
                </div>

                <div class="flex-shrink-0 z-10 w-full md:w-auto">
                    <a href="/all.html"
                        class="flex items-center justify-center w-full md:w-auto px-6 py-2.5 rounded-full bg-[#333333] hover:bg-white text-white hover:text-black text-[14px] font-bold transition-all duration-300 group-hover:shadow-md">
                        ë” ì•Œì•„ë³´ê¸° <i class="fa-solid fa-chevron-right ml-2 text-[10px]"></i>
                    </a>
                </div>

            </div>
        </section>

        <section class="slide-section">
            <div class="section-header">
                <h3 id="result-message">ì¶”ì²œ ì •ì±… (20ê±´)</h3>
            </div>
            <div class="relative marquee-wrapper">
                <div
                    class="absolute top-0 left-0 h-full w-16 bg-gradient-to-r from-white to-transparent z-10 pointer-events-none">
                </div>
                <div
                    class="absolute top-0 right-0 h-full w-16 bg-gradient-to-l from-white to-transparent z-10 pointer-events-none">
                </div>
                <div class="marquee-row scroll-left" id="slide-row-1"></div>
                <div class="marquee-row scroll-right" id="slide-row-2"></div>
            </div>
        </section>

        <section class="membership-section">
            <div class="membership-content">
                <h2>ë‚˜ì—ê²Œ<br>ì •ë§ í•„ìš”í•œ ì •ì±…ë§Œ<br>ì°¨ê³¡ì°¨ê³¡ ìŒ“ì•„ ë´ìš”!</h2>
                <div class="membership-btns">
                    <button id="btn-membership-signup" class="btn-primary-red js-login-trigger"
                        data-mode="signup">íšŒì›ê°€ì…</button>
                    <button id="btn-share" class="btn-secondary-white">ê³µìœ í•˜ê¸°</button>
                </div>
                <div class="membership-img">
                    <img src="/static/images/membership_image.png"
                        onerror="this.src='https://placehold.co/400x300/transparent/orange?text=Login+Illustration'"
                        alt="Membership Illustration">
                </div>
            </div>
        </section>
    </main>

    <div class="marquee-area">
        <div class="track"><span>ì„œìš¸ì‹œ ì²­ë…„ ì •ì±… ëª¨ìŒ ğŸš€ ì·¨ì—…ë¶€í„° ì£¼ê±°ê¹Œì§€ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”! &nbsp;&nbsp;&nbsp; ì„œìš¸ì‹œ ì²­ë…„ ì •ì±… ëª¨ìŒ ğŸš€ ì·¨ì—…ë¶€í„° ì£¼ê±°ê¹Œì§€ í•œëˆˆì—
                í™•ì¸í•˜ì„¸ìš”! &nbsp;&nbsp;&nbsp; </span></div>
    </div>

    <div id="share-modal"
        class="fixed inset-0 z-[9999] flex items-center justify-center bg-black/40 hidden opacity-0 transition-opacity duration-300">
        <div
            class="bg-white rounded-3xl shadow-2xl p-8 max-w-sm w-full mx-4 transform scale-95 transition-transform duration-300 relative">

            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-extrabold text-gray-900">ê³µìœ í•˜ê¸°</h3>
                <button id="btn-share-close" class="text-gray-400 hover:text-gray-600 transition-colors p-1">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>

            <div class="space-y-4">
                <p class="text-gray-500 text-sm">
                    ì•„ë˜ ë§í¬ë¥¼ ë³µì‚¬í•´ì„œ ì¹œêµ¬ë“¤ì—ê²Œ<br>ì²­ë…„ ì •ì±… ì •ë³´ë¥¼ ê³µìœ í•´ë³´ì„¸ìš”! ğŸ“¢
                </p>

                <div class="flex items-center gap-2 bg-gray-50 rounded-xl p-2 border border-gray-200">
                    <input type="text" id="share-url-input"
                        class="bg-transparent border-none outline-none text-sm text-gray-600 flex-1 px-2 font-medium"
                        readonly>
                    <button id="btn-copy-url"
                        class="px-4 py-2 bg-gray-900 text-white text-xs font-bold rounded-lg hover:bg-black transition-colors shadow-md">
                        ë³µì‚¬
                    </button>
                </div>
            </div>

        </div>
    </div>

    <script>
        // [ì„œë²„ ë°ì´í„° ì—°ë™] 
        // íŒŒì´ì¬ì—ì„œ ë§Œë“  ë¦¬ìŠ¤íŠ¸ë¥¼ Jinja2ì˜ 'tojson' í•„í„°ë¥¼ í†µí•´ ì•ˆì „í•œ JSONìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
        // ì¤„ë°”ê¿ˆ, ë”°ì˜´í‘œ ë¬¸ì œê°€ ìë™ìœ¼ë¡œ í•´ê²°ë©ë‹ˆë‹¤.

        window.tinderData = {{ tinder_data_list | tojson | safe }};
        window.allSlideData = {{ slider_data_list | tojson | safe }};

        // ë°ì´í„° í™•ì¸ìš© ë¡œê·¸ (ê°œë°œì ë„êµ¬ Console íƒ­ì—ì„œ í™•ì¸ ê°€ëŠ¥)
        console.log("ğŸ”¥ ë¡œë“œëœ í‹´ë” ë°ì´í„°:", window.tinderData);
        console.log("ğŸ”¥ ë¡œë“œëœ ìŠ¬ë¼ì´ë“œ ë°ì´í„°:", window.allSlideData);
    </script>

    <script src="/static/script.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // ... ê¸°ì¡´ ë¡œì§ (region ì²˜ë¦¬, ì• ë‹ˆë©”ì´ì…˜ ë“±) ê·¸ëŒ€ë¡œ ìœ ì§€ ...
            // (ì´ ì•„ë˜ ì½”ë“œëŠ” ê±´ë“œë¦´ í•„ìš” ì—†ìŠµë‹ˆë‹¤)

            // [ì•ˆì „ì¥ì¹˜] ë§Œì•½ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê²½ê³ 
            if (!window.tinderData || window.tinderData.length === 0) {
                console.warn("âš ï¸ ë°ì´í„°ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. DBë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
            }

            // ... (ë‚˜ë¨¸ì§€ ì½”ë“œ ìƒëµ) ...
        });
    </script>

    <!-- [ì¶”ê°€] no-more-cards ìš”ì†Œ ê°ì§€ ë° ë‚´ìš© ë³€ê²½ -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            function updateNoMoreCardsElement(element) {
                // ì´ë¯¸ ì—…ë°ì´íŠ¸ëœ ê²½ìš° ìŠ¤í‚µ
                if (element.querySelector('.mypage-link-btn') || element.querySelector('.load-more-cards-btn')) {
                    return;
                }

                // ìœ„ì¹˜ ì¡°ì •ë§Œ í•˜ê³  ê¸°ì¡´ ë©”ì‹œì§€ëŠ” ìœ ì§€ (CSSì—ì„œ ì´ë¯¸ ì„¤ì •ë¨)

                // ê¸°ì¡´ ë‚´ìš©ì„ ìœ ì§€í•˜ë©´ì„œ ë²„íŠ¼ë§Œ ì¶”ê°€
                const existingText = element.textContent || element.innerText;
                // ì´ëª¨í‹°ì½˜ ì œê±° (ğŸ‰)
                const textWithoutEmoji = existingText.replace(/ğŸ‰/g, '').trim();
                element.innerHTML = `
                    <p style="margin-bottom: 60px; font-size: 1.2rem; font-weight: bold; color: #666;">
                        ${textWithoutEmoji}
                    </p>
                    <button class="mypage-link-btn" onclick="window.location.href='/mypage.html'" title="My Pageë¡œ ê°€ê¸°">
                        ì°œí•œ ì •ì±… ë³´ëŸ¬ê°€ê¸°
                    </button>
                    <button class="load-more-cards-btn" onclick="loadMoreCards()" title="ì •ì±… ì¹´ë“œ ë”ë³´ê¸°">
                        ì •ì±… ì¹´ë“œ ë”ë³´ê¸°
                    </button>
                `;
            }

            // MutationObserverë¡œ .no-more-cards ìš”ì†Œ ê°ì§€
            const tinderList = document.getElementById('tinder-list');
            if (tinderList) {
                const observer = new MutationObserver((mutations) => {
                    const noMoreCards = document.querySelector('.no-more-cards');
                    if (noMoreCards) {
                        updateNoMoreCardsElement(noMoreCards);
                    }
                });

                // ê´€ì°° ì‹œì‘
                observer.observe(tinderList, {
                    childList: true,
                    subtree: true
                });

                // ì´ˆê¸° ì²´í¬ (ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê²½ìš°)
                setTimeout(() => {
                    const existing = document.querySelector('.no-more-cards');
                    if (existing) {
                        updateNoMoreCardsElement(existing);
                    }
                }, 100);
            }
        });
    </script>
</body>

</html>
<script src="/static/script.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        // [ì„œë²„ ë°ì´í„° ì—°ë™] DBì—ì„œ ê°€ì ¸ì˜¨ ì •ì±… ë¦¬ìŠ¤íŠ¸ë¥¼ JS ê°ì²´ë¡œ ë³€í™˜
        // [ì„œë²„ ë°ì´í„° ì—°ë™] 
        // ë°ì´í„°ëŠ” ìœ„ìª½ ìŠ¤í¬ë¦½íŠ¸(window.tinderData)ì—ì„œ ì´ë¯¸ ì „ì—­ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.
        // script.jsê°€ ì´ë¥¼ ì°¸ì¡°í•˜ì—¬ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
        // ë§Œì•½ ì„œë²„ ë°ì´í„°ê°€ ì—†ì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ ë”ë¯¸ ë°ì´í„° (ì„ íƒ ì‚¬í•­ - í˜„ì¬ëŠ” ë¹„ì›Œë‘ )
        if (window.tinderData.length === 0) {
            console.warn("No policy data loaded from server.");
        }
        // ë³€ìˆ˜ ì„¤ì •
        const urlParams = new URLSearchParams(window.location.search);
        let regionId = urlParams.get('region');
        const showAnim = urlParams.get('anim');
        const preloader = document.getElementById('preloader');

        // Session Storage ì²˜ë¦¬
        if (regionId) {
            sessionStorage.setItem('sseuk_selected_region', regionId);
        } else {
            const savedRegion = sessionStorage.getItem('sseuk_selected_region');
            if (savedRegion) regionId = savedRegion;
        }

        const REGION_NAMES = {
            'gangwon': 'ê°•ì›ë„', 'chungbug': 'ì¶©ì²­ë¶ë„', 'jeonbug': 'ì „ë¼ë¶ë„', 'jeju': 'ì œì£¼íŠ¹ë³„ìì¹˜ë„',
            'detail_seoul': 'ì„œìš¸íŠ¹ë³„ì‹œ', 'detail_incheon': 'ì¸ì²œê´‘ì—­ì‹œ', 'detail_gyeonggi': 'ê²½ê¸°ë„',
            'detail_daejun': 'ëŒ€ì „ê´‘ì—­ì‹œ', 'detail_saejong': 'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ', 'detail_chungnam': 'ì¶©ì²­ë‚¨ë„',
            'detail_gwangju': 'ê´‘ì£¼ê´‘ì—­ì‹œ', 'detail_jeonnam': 'ì „ë¼ë‚¨ë„',
            'detail_daegu': 'ëŒ€êµ¬ê´‘ì—­ì‹œ', 'detail_gyeongbug': 'ê²½ìƒë¶ë„',
            'detail_busan': 'ë¶€ì‚°ê´‘ì—­ì‹œ', 'detail_ulsan': 'ìš¸ì‚°ê´‘ì—­ì‹œ', 'detail_gyeongnam': 'ê²½ìƒë‚¨ë„'
        };

        const headerTitle = document.querySelector('.header-text h1');
        const headerDesc = document.querySelector('.header-text p');
        const searchInput = document.getElementById('search-input');

        // [ë°ì´í„° êµì²´] ì§€ì—­ì— ë§ëŠ” í…ìŠ¤íŠ¸ë¡œ ë³€ê²½
        if (regionId && REGION_NAMES[regionId]) {
            const regionName = REGION_NAMES[regionId];
            if (headerTitle) headerTitle.innerHTML = `<span class="text-primary-teal">${regionName}</span>ì˜<br>ì²­ë…„ ì •ì±… ì†Œì‹`;
            if (headerDesc) headerDesc.innerHTML = `${regionName} ì²­ë…„ë“¤ì„ ìœ„í•œ ë§ì¶¤ ì •ì±…ì„ ëª¨ì•˜ìŠµë‹ˆë‹¤.<br>ì§€ê¸ˆ ë°”ë¡œ í™•ì¸í•´ë³´ì„¸ìš”!`;
            if (searchInput) searchInput.value = `#${regionName} #ì·¨ì—… #ì£¼ê±°`;
        } else {
            if (headerTitle) headerTitle.innerHTML = `ì“±-ì“± í›‘ì–´ë³´ëŠ”<br>ì²­ë…„ ì •ì±… ì†Œì‹`;
            if (headerDesc) headerDesc.innerHTML = `ë‚˜ì—ê²Œ ë”± ë§ëŠ” ì •ì±…ì„ ì‰½ê³  ë¹ ë¥´ê²Œ ì°¾ì•„ë³´ì„¸ìš”.<br>ë§¤ì¼ ì—…ë°ì´íŠ¸ë˜ëŠ” ìƒˆë¡œìš´ ì†Œì‹ì„ ë†“ì¹˜ì§€ ë§ˆì„¸ìš”!`;
        }

        // [ë¡œë”© ì¢…ë£Œ ì•ˆì „ì¥ì¹˜]
        function forceHidePreloader() {
            if (preloader && preloader.style.display !== 'none') {
                if (typeof gsap !== 'undefined') {
                    gsap.to(preloader, {
                        opacity: 0,
                        duration: 0.5,
                        onComplete: () => {
                            preloader.style.display = 'none';
                            if (window.playHeaderAnimation) window.playHeaderAnimation();
                        }
                    });
                } else {
                    preloader.style.display = 'none';
                }
            }
        }

        if (showAnim === '1') {
            setTimeout(() => forceHidePreloader(), 3000);
        } else {
            if (preloader) preloader.style.display = 'none';
            setTimeout(() => {
                if (window.playHeaderAnimation) window.playHeaderAnimation();
            }, 50);
        }
    });
</script>

<!-- policy-modal -->

{% include "components/policy_modal.html" %}

<script src="/static/policy_modal.js"></script>

<!-- auth-modal -->

{% with btn_class="bg-[#FF5A5F] hover:bg-[#e04a4f]" %}
{% include "components/auth_modal.html" %}
{% endwith %}

<script>
    // íšŒì›ê°€ì… ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateMembershipButton() {
        const btn = document.getElementById('btn-membership-signup');
        if (!btn) return;

        const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
        const userEmail = localStorage.getItem('userEmail');

        if (isLoggedIn && userEmail) {
            // ë¡œê·¸ì¸ ìƒíƒœ: Logout ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½
            btn.textContent = 'Logout';
            btn.classList.remove('js-login-trigger');
            btn.removeAttribute('data-mode');

            // ê¸°ì¡´ í´ë¦­ ì´ë²¤íŠ¸ ì œê±° í›„ ìƒˆ ì´ë²¤íŠ¸ ì¶”ê°€
            btn.onclick = function (e) {
                e.preventDefault();
                if (window.handleLogout) {
                    window.handleLogout();
                }
            };
        } else {
            // ë¡œê·¸ì•„ì›ƒ ìƒíƒœ: íšŒì›ê°€ì… ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½
            btn.textContent = 'íšŒì›ê°€ì…';
            btn.classList.add('js-login-trigger');
            btn.setAttribute('data-mode', 'signup');

            // í´ë¦­ ì´ë²¤íŠ¸ ì œê±° (ê¸°ì¡´ js-login-trigger í•¸ë“¤ëŸ¬ê°€ ì‘ë™í•˜ë„ë¡)
            btn.onclick = null;
        }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
    document.addEventListener("DOMContentLoaded", () => {
        // ì´ˆê¸° ì—…ë°ì´íŠ¸
        updateMembershipButton();

        // checkLoginState() ì‹¤í–‰ í›„ ì—…ë°ì´íŠ¸ (ì•½ê°„ì˜ ì§€ì—° í›„)
        setTimeout(() => {
            updateMembershipButton();
        }, 100);

        // localStorage ë³€ê²½ ê°ì§€í•˜ì—¬ ë²„íŠ¼ ì—…ë°ì´íŠ¸
        window.addEventListener('storage', () => {
            updateMembershipButton();
        });

        // ì£¼ê¸°ì ìœ¼ë¡œ í™•ì¸ (ë¡œê·¸ì¸/íšŒì›ê°€ì… ì„±ê³µ í›„ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´)
        setInterval(() => {
            updateMembershipButton();
        }, 500);
    });

    // ë¡œê·¸ì¸/íšŒì›ê°€ì… ì„±ê³µ í›„ ë²„íŠ¼ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ ì „ì—­ í•¨ìˆ˜
    window.updateMembershipButton = updateMembershipButton;
</script>

<script>
    // [GSAP ê¸°ë°˜] ë§ˆí‚¤ ìŠ¬ë¼ì´ë“œ ì• ë‹ˆë©”ì´ì…˜ (CSS ì• ë‹ˆë©”ì´ì…˜ ëŒ€ì²´)
    document.addEventListener("DOMContentLoaded", () => {
        const row1 = document.getElementById('slide-row-1');
        const row2 = document.getElementById('slide-row-2');
        const modal = document.getElementById('policy-modal');

        if (!row1 || !row2) return;

        // GSAP ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸
        if (typeof gsap === 'undefined') {
            console.warn('GSAP ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë§ˆí‚¤ ì• ë‹ˆë©”ì´ì…˜ì´ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            return;
        }

        // [í•µì‹¬] ê¸°ì¡´ CSS ì• ë‹ˆë©”ì´ì…˜ì´ GSAPì™€ ì¶©ëŒí•˜ì§€ ì•Šë„ë¡ ê°•ì œ ì¢…ë£Œ
        // style.cssë¥¼ ìˆ˜ì •í•˜ì§€ ì•Šê³  ì—¬ê¸°ì„œ ì²˜ë¦¬í•¨ìœ¼ë¡œì„œ ì‚¬ì´ë“œ ì´í™íŠ¸ ë°©ì§€
        row1.style.animation = 'none';
        row2.style.animation = 'none';

        // 1. ì»¨í…ì¸  ë³µì œ í•¨ìˆ˜
        let tween1, tween2;
        let contentDuplicated = { row1: false, row2: false };

        function duplicateContent(element, rowKey) {
            // ì´ë¯¸ ë³µì œëœ ê²½ìš° ìŠ¤í‚µ
            if (contentDuplicated[rowKey]) return;

            // ë‚´ìš©ì´ ë Œë”ë§ë  ë•Œê¹Œì§€ ì ì‹œ ëŒ€ê¸° í›„ ë³µì œ
            const checkContent = setInterval(() => {
                if (element.children.length > 0) {
                    clearInterval(checkContent);
                    element.innerHTML += element.innerHTML;
                    contentDuplicated[rowKey] = true;

                    // ë‘ í–‰ ëª¨ë‘ ë³µì œ ì™„ë£Œë˜ë©´ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
                    if (contentDuplicated.row1 && contentDuplicated.row2) {
                        startMarquee();
                    }
                }
            }, 100);
        }

        // 2. GSAP ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
        function startMarquee() {
            // ì´ë¯¸ ì‹œì‘ëœ ê²½ìš° ìŠ¤í‚µ
            if (tween1 || tween2) return;

            // row1: ì™¼ìª½ìœ¼ë¡œ ì´ë™ (-50% ë°©í–¥)
            tween1 = gsap.to(row1, {
                xPercent: -50,
                ease: "none",
                duration: 60,
                repeat: -1
            });

            // row2: ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™ (ì´ˆê¸°ê°’ -50%ì—ì„œ 0%ë¡œ)
            gsap.set(row2, { xPercent: -50 });
            tween2 = gsap.to(row2, {
                xPercent: 0,
                ease: "none",
                duration: 65,
                repeat: -1
            });
        }

        // ì»¨í…ì¸  ë³µì œ ì‹œì‘
        duplicateContent(row1, 'row1');
        duplicateContent(row2, 'row2');

        // 3. ëª¨ë‹¬ ê°ì§€ ë° ì†ë„ ì œì–´ (TimeScale)
        if (modal) {
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        const isOpen = modal.classList.contains('active') && !modal.classList.contains('hidden');
                        const targetScale = isOpen ? 0.1 : 1;
                        const duration = isOpen ? 1.5 : 1;

                        if (tween1) gsap.to(tween1, { timeScale: targetScale, duration: duration });
                        if (tween2) gsap.to(tween2, { timeScale: targetScale, duration: duration });
                    }
                });
            });

            observer.observe(modal, {
                attributes: true,
                attributeFilter: ['class']
            });
        }
    });
</script>

<!-- [ì¶”ê°€] ì •ì±… ì¹´ë“œ ë”ë³´ê¸° ê¸°ëŠ¥ -->
<script>
    // loadMoreCards í•¨ìˆ˜ êµ¬í˜„ (AJAX ë°©ì‹)
    async function loadMoreCards() {
        // 1. í˜„ì¬ ì¹´ë“œ ID ìˆ˜ì§‘
        const currentIds = [];
        if (window.tinderData && Array.isArray(window.tinderData)) {
            window.tinderData.forEach(card => {
                if (card.id) currentIds.push(card.id.toString());
            });
        }

        // 2. sessionStorageì—ì„œ ê¸°ì¡´ ID ê°€ì ¸ì˜¤ê¸°
        const storedIds = sessionStorage.getItem('seen_policy_ids');
        let seenIds = storedIds ? storedIds.split(',') : [];

        // 3. ì¤‘ë³µ ì œê±°í•˜ì—¬ í•©ì¹˜ê¸°
        const allSeenIds = [...new Set([...seenIds, ...currentIds])].filter(id => id);

        // 4. sessionStorageì— ì €ì¥
        sessionStorage.setItem('seen_policy_ids', allSeenIds.join(','));

        // 5. ë²„íŠ¼ ìƒíƒœ ë³€ê²½
        const btn = document.querySelector('.load-more-cards-btn');
        if (btn) {
            btn.textContent = "ìƒˆë¡œìš´ ì •ì±… ì°¾ëŠ” ì¤‘...";
            btn.disabled = true;
        }

        // 6. URL íŒŒë¼ë¯¸í„° êµ¬ì„±
        const urlParams = new URLSearchParams();
        urlParams.set('exclude_ids', allSeenIds.join(','));

        // region íŒŒë¼ë¯¸í„° ì¶”ê°€
        const currentUrlParams = new URLSearchParams(window.location.search);
        let region = currentUrlParams.get('region');
        if (!region) {
            region = sessionStorage.getItem('sseuk_selected_region');
        }
        if (region) {
            urlParams.set('region', region);
        }

        try {
            // 7. AJAXë¡œ ìƒˆ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const response = await fetch(`/api/main/more-cards?${urlParams.toString()}`);
            const data = await response.json();

            // 8. ë°ì´í„°ê°€ ì—†ìœ¼ë©´ alert ë° ë²„íŠ¼ ë¹„í™œì„±í™”
            if (!data.cards || data.cards.length === 0) {
                alert("ë” ì´ìƒ ì •ì±…ì´ ì—†ìŠµë‹ˆë‹¤.");
                if (btn) {
                    btn.textContent = "ë” ì´ìƒ ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤";
                    btn.disabled = true;
                    btn.style.opacity = "0.5";
                    btn.style.cursor = "not-allowed";
                }
                return;
            }

            // 9. window.tinderData ì—…ë°ì´íŠ¸
            window.tinderData = data.cards;

            // 10. #tinder-list ì»¨í…Œì´ë„ˆ ì™„ì „íˆ ë¹„ìš°ê¸°
            const tinderList = document.getElementById('tinder-list');
            if (!tinderList) return;

            tinderList.innerHTML = '';

            // 11. .no-more-cards ìš”ì†Œ ìˆ¨ê¸°ê¸°
            const noMoreCards = document.querySelector('.no-more-cards');
            if (noMoreCards) {
                noMoreCards.remove();
            }

            // 12. ìƒˆë¡œìš´ CardSwiper ì¸ìŠ¤í„´ìŠ¤ ìƒì„± (script.jsì˜ í´ë˜ìŠ¤ ì¬ì‚¬ìš©)
            // script.jsê°€ ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆìœ¼ë¯€ë¡œ CardSwiper í´ë˜ìŠ¤ë¥¼ ì‚¬ìš© ê°€ëŠ¥
            new CardSwiper(tinderList, window.tinderData);

            // 13. ë²„íŠ¼ ìƒíƒœ ë³µêµ¬
            if (btn) {
                btn.textContent = "ì •ì±… ì¹´ë“œ ë”ë³´ê¸°";
                btn.disabled = false;
                btn.style.opacity = "";
                btn.style.cursor = "";
            }

        } catch (error) {
            console.error("ì¹´ë“œ ë¡œë“œ ì‹¤íŒ¨:", error);
            alert("ì¹´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            // ë²„íŠ¼ ìƒíƒœ ë³µêµ¬
            if (btn) {
                btn.textContent = "ì •ì±… ì¹´ë“œ ë”ë³´ê¸°";
                btn.disabled = false;
            }
        }
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ì—†ìŒ ìƒíƒœ ì²˜ë¦¬
    document.addEventListener("DOMContentLoaded", () => {
        // ë°ì´í„° ì—†ìŒ ìƒíƒœ ì²˜ë¦¬
        if (!window.tinderData || window.tinderData.length === 0) {
            // MutationObserverë¡œ ë²„íŠ¼ì´ ë‚˜íƒ€ë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
            const checkAndDisableButton = () => {
                const loadMoreBtn = document.querySelector('.load-more-cards-btn');
                if (loadMoreBtn) {
                    loadMoreBtn.textContent = "ë” ì´ìƒ ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤";
                    loadMoreBtn.disabled = true;
                    loadMoreBtn.style.opacity = "0.5";
                    loadMoreBtn.style.cursor = "not-allowed";
                } else {
                    // ë²„íŠ¼ì´ ì•„ì§ ë‚˜íƒ€ë‚˜ì§€ ì•Šì•˜ìœ¼ë©´ ë‹¤ì‹œ ì‹œë„
                    setTimeout(checkAndDisableButton, 100);
                }
            };

            // ì´ˆê¸° ì²´í¬
            checkAndDisableButton();
        }
    });
</script>

</body>

</html>