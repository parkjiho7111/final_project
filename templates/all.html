<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì „ì²´ ì •ì±… ë³´ê¸° | ì“±ì“±</title>

    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="/static/script.js" defer></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-orange': '#F48245',
                        'primary-teal': '#4A9EA8',
                        'primary-beige': '#D9B36C'
                    },
                    fontFamily: { sans: ['Pretendard', 'sans-serif'] },
                    screens: { 'xs': '500px' },
                    boxShadow: {
                        'floating': '0 20px 40px -5px rgba(0, 0, 0, 0.15), 0 10px 20px -5px rgba(0, 0, 0, 0.1)',
                    }
                }
            }
        }
    </script>
    <style>
        .perspective-wrap {
            perspective: 1000px;
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .card-lifter {
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            will-change: transform;
        }

        .policy-card {
            transform-style: preserve-3d;
            backface-visibility: hidden;
            -webkit-font-smoothing: antialiased;
            transform: translateZ(0);
            width: 100%;
            height: 100%;
        }

        .card-content {
            transform: translateZ(1px);
            background-color: #fff;
        }

        .card-image {
            transform-style: preserve-3d;
            transform: translateZ(20px);
        }

        #region-btn {
            background-color: rgba(255, 255, 255, 1);
            color: rgba(81, 82, 81, 1);
        }
    </style>
</head>

<body class="bg-gray-50 font-sans">

    {% include "nav.html" %}

    <main class="max-w-[1200px] mx-auto px-5 py-10">
        <header class="text-center mb-16">
            <h1 class="text-3xl md:text-5xl font-extrabold text-gray-900 mb-4 tracking-tight">ì •ì±… ì¹´ë“œ ì»¬ë ‰ì…˜ âœ¨</h1>
            <p class="text-gray-500 text-lg mb-5">ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë ¤ë³´ì„¸ìš”! í™”ë©´ í¬ê¸°ì— ë§ì¶° ì¹´ë“œê°€ ë°˜ì‘í•©ë‹ˆë‹¤.</p>

            <div class="max-w-2xl mx-auto mb-6">
                <div class="flex items-center gap-2">
                    <div
                        class="relative flex items-center flex-1 h-14 rounded-full focus-within:shadow-lg bg-white overflow-visible border border-gray-200 shadow-sm transition-shadow duration-300">
                        <div class="grid place-items-center h-full w-12 text-gray-400">
                            <i class="fa-solid fa-magnifying-glass text-lg ml-2"></i>
                        </div>
                        <input
                            class="peer h-full w-full outline-none pr-44 pl-2 text-base bg-transparent placeholder-gray-400"
                            style="color: #1f2937;" type="text" id="search-input"
                            placeholder="í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”( ì¸ê¸°ê²€ìƒ‰ì–´: ì£¼ê±°ì§€ì›, ì·¨ì—…)" />
                        <button id="clear-btn"
                            class="hidden absolute right-44 text-gray-400 hover:text-gray-600 focus:outline-none transition-colors z-10">
                            <i class="fa-solid fa-circle-xmark text-xl"></i>
                        </button>
                        <!-- ì§€ì—­ ë²„íŠ¼ -->
                        <button id="region-btn"
                            class="shrink-0 px-4 py-2 my-1 rounded-lg text-gray-600 text-sm font-bold hover:bg-green-50 hover:text-green-500 transition-all flex items-center gap-2">
                            <i class="fa-solid fa-map"></i> ì§€ì—­
                        </button>
                        <!-- êµ¬ë¶„ì„  -->
                        <div class="h-8 w-px bg-gray-200 mx-2 flex-shrink-0"></div>
                        <!-- ì •ë ¬ ë²„íŠ¼ -->
                        <button id="sort-btn"
                            class="shrink-0 py-2 h-full text-gray-600 text-sm font-bold transition-all flex items-center gap-1"
                            style="min-width: 73px; width: 73px; padding-left: 6px; padding-right: 4px;">
                            <i class="fa-solid fa-sort" style="flex-shrink: 0;"></i> <span class="sort-text"
                                style="display: inline-block; width: 3ch; text-align: left; flex: 1;">ì •ë ¬</span>
                        </button>

                        <!-- ìµœê·¼ ê²€ìƒ‰ì–´ ëª©ë¡ -->
                        <div id="recent-searches"
                            class="hidden absolute top-full left-0 w-1/2 mt-2 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-64 overflow-y-auto">
                            <div class="flex items-center justify-between p-3 border-b border-gray-100">
                                <h4 class="text-xs font-semibold text-gray-500 uppercase">ìµœê·¼ ê²€ìƒ‰ì–´</h4>
                                <button id="clear-all-searches"
                                    class="text-xs text-gray-400 hover:text-gray-600 transition-colors">
                                    ì „ë¶€ ì‚­ì œ
                                </button>
                            </div>
                            <div id="recent-searches-list" class="p-2">
                                <!-- ê²€ìƒ‰ì–´ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="relative w-full max-w-[800px] mx-auto group px-8 sm:px-0">
                <button id="scroll-left"
                    class="absolute left-0 top-1/2 -translate-y-1/2 z-10 w-8 h-8 rounded-full bg-black/20 text-white backdrop-blur-sm flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300 hover:bg-black/40 sm:hidden">
                    <i class="fa-solid fa-chevron-left"></i>
                </button>

                <div id="category-filters"
                    class="flex gap-2 overflow-x-auto pb-2 sm:justify-center justify-start hide-scrollbar scroll-smooth snap-x">
                    <button
                        class="filter-btn active snap-center shrink-0 px-5 py-2.5 rounded-full bg-[#777777] text-white text-sm font-bold transition-all shadow-md hover:bg-[#555555] hover:text-white flex items-center gap-2"
                        data-category="all"><i class="fa-solid fa-layer-group"></i> ì „ì²´</button>
                    <button
                        class="filter-btn snap-center shrink-0 px-5 py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-teal-50 hover:text-primary-teal hover:border-primary-teal transition-all flex items-center gap-2"
                        data-category="ì·¨ì—…"><i class="fa-solid fa-briefcase"></i> ì·¨ì—…</button>
                    <button
                        class="filter-btn snap-center shrink-0 px-5 py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-orange-50 hover:text-primary-orange hover:border-primary-orange transition-all flex items-center gap-2"
                        data-category="ì£¼ê±°"><i class="fa-solid fa-house-chimney"></i> ì£¼ê±°</button>
                    <button
                        class="filter-btn snap-center shrink-0 px-5 py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-yellow-50 hover:text-primary-beige hover:border-primary-beige transition-all flex items-center gap-2"
                        data-category="ê¸ˆìœµ"><i class="fa-solid fa-coins"></i> ê¸ˆìœµ</button>
                    <button
                        class="filter-btn snap-center shrink-0 px-5 py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-red-50 hover:text-[#FF5A5F] hover:border-[#FF5A5F] transition-all flex items-center gap-2"
                        data-category="ì°½ì—…"><i class="fa-solid fa-rocket"></i> ì°½ì—…</button>
                    <button
                        class="filter-btn snap-center shrink-0 px-5 py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-purple-50 hover:text-purple-500 hover:border-purple-500 transition-all flex items-center gap-2"
                        data-category="ë³µì§€"><i class="fa-solid fa-hand-holding-heart"></i> ë³µì§€</button>
                    <button
                        class="filter-btn snap-center shrink-0 px-5 py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-blue-50 hover:text-blue-500 hover:border-blue-500 transition-all flex items-center gap-2"
                        data-category="êµìœ¡"><i class="fa-solid fa-graduation-cap"></i> êµìœ¡</button>
                </div>

                <button id="scroll-right"
                    class="absolute right-0 top-1/2 -translate-y-1/2 z-10 w-8 h-8 rounded-full bg-black/20 text-white backdrop-blur-sm flex items-center justify-center sm:hidden hover:bg-black/40 transition-colors">
                    <i class="fa-solid fa-chevron-right"></i>
                </button>
            </div>
        </header>

        <div id="card-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 pb-10">
        </div>

        <div id="loading-indicator" class="hidden w-full flex justify-center items-center py-10">
            <div class="animate-spin rounded-full h-10 w-10 border-t-4 border-b-4 border-primary-teal"></div>
        </div>

        <div id="pagination-container" class="flex justify-center flex-wrap gap-2 py-8 mt-4"></div>

        <div id="no-result" class="hidden text-center py-20">
            <div class="text-6xl mb-4 grayscale opacity-50">ğŸ¤”</div>
            <h3 class="text-xl font-bold text-gray-700 mb-2">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ì–´ìš”.</h3>
            <p class="text-gray-500">ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•˜ê±°ë‚˜ í•„í„°ë¥¼ 'ì „ì²´'ë¡œ ë³€ê²½í•´ë³´ì„¸ìš”.</p>
        </div>
    </main>

    <!-- ì§€ì—­ ì„ íƒ ëª¨ë‹¬ -->
    <div id="region-modal"
        class="fixed inset-0 z-[9999] flex items-center justify-center bg-black/40 hidden opacity-0 transition-opacity duration-300">
        <div
            class="bg-white rounded-3xl shadow-2xl p-8 max-w-4xl w-full mx-4 transform scale-95 transition-transform duration-300 relative">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-extrabold text-gray-900">ëŒ€ìƒ ì§€ì—­ ì„ íƒ</h3>
                <button id="region-modal-close" class="text-gray-400 hover:text-gray-600 transition-colors p-1">
                    <i class="fa-solid fa-xmark text-xl"></i>
                </button>
            </div>

            <!-- ë°˜ì‘í˜• ê·¸ë¦¬ë“œ: ëª¨ë°”ì¼ 4ì»¬ëŸ¼, íƒœë¸”ë¦¿ 6ì»¬ëŸ¼, PC 10ì»¬ëŸ¼ -->
            <div class="grid gap-2 grid-cols-4 sm:grid-cols-6 lg:grid-cols-10 auto-rows-fr">
                <!-- ì „ì²´ ë²„íŠ¼: ì„¸ë¡œë¡œ 2ì¤„ í†µí•© (row-span-2) -->
                <button
                    class="region-option-btn w-full px-3 py-4 sm:px-5 sm:py-5 rounded-lg bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2 row-span-2"
                    data-region="ì „ì²´">ì „ì²´</button>

                <!-- ì²« ë²ˆì§¸ í–‰: ì „êµ­ ì„œìš¸ ê²½ê¸° ì¸ì²œ ê²½ë¶ ëŒ€êµ¬ ê²½ë‚¨ ë¶€ì‚° ìš¸ì‚° (9ê°œ) -->
                <button
                    class="region-option-btn w-full px-3 py-2.5 sm:px-5 sm:py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-region="ì „êµ­">ì „êµ­</button>
                <button
                    class="region-option-btn w-full px-3 py-2.5 sm:px-5 sm:py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-region="ì„œìš¸">ì„œìš¸</button>
                <button
                    class="region-option-btn w-full px-3 py-2.5 sm:px-5 sm:py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-region="ê²½ê¸°">ê²½ê¸°</button>
                <button
                    class="region-option-btn w-full px-3 py-2.5 sm:px-5 sm:py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-region="ì¸ì²œ">ì¸ì²œ</button>
                <button
                    class="region-option-btn w-full px-3 py-2.5 sm:px-5 sm:py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-region="ê²½ë¶">ê²½ë¶</button>
                <button
                    class="region-option-btn w-full px-3 py-2.5 sm:px-5 sm:py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-region="ëŒ€êµ¬">ëŒ€êµ¬</button>
                <button
                    class="region-option-btn w-full px-3 py-2.5 sm:px-5 sm:py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-region="ê²½ë‚¨">ê²½ë‚¨</button>
                <button
                    class="region-option-btn w-full px-3 py-2.5 sm:px-5 sm:py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-region="ë¶€ì‚°">ë¶€ì‚°</button>
                <button
                    class="region-option-btn w-full px-3 py-2.5 sm:px-5 sm:py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-region="ìš¸ì‚°">ìš¸ì‚°</button>

                <!-- ë‘ ë²ˆì§¸ í–‰: ì „ë‚¨ ê´‘ì£¼ ì „ë¶ ê°•ì› ì¶©ë‚¨ ì¶©ë¶ ëŒ€ì „ ì„¸ì¢… ì œì£¼ (9ê°œ) -->
                <button
                    class="region-option-btn w-full px-3 py-2.5 sm:px-5 sm:py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-region="ì „ë‚¨">ì „ë‚¨</button>
                <button
                    class="region-option-btn w-full px-3 py-2.5 sm:px-5 sm:py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-region="ê´‘ì£¼">ê´‘ì£¼</button>
                <button
                    class="region-option-btn w-full px-3 py-2.5 sm:px-5 sm:py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-region="ì „ë¶">ì „ë¶</button>
                <button
                    class="region-option-btn w-full px-3 py-2.5 sm:px-5 sm:py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-region="ê°•ì›">ê°•ì›</button>
                <button
                    class="region-option-btn w-full px-3 py-2.5 sm:px-5 sm:py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-region="ì¶©ë‚¨">ì¶©ë‚¨</button>
                <button
                    class="region-option-btn w-full px-3 py-2.5 sm:px-5 sm:py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-region="ì¶©ë¶">ì¶©ë¶</button>
                <button
                    class="region-option-btn w-full px-3 py-2.5 sm:px-5 sm:py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-region="ëŒ€ì „">ëŒ€ì „</button>
                <button
                    class="region-option-btn w-full px-3 py-2.5 sm:px-5 sm:py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-region="ì„¸ì¢…">ì„¸ì¢…</button>
                <button
                    class="region-option-btn w-full px-3 py-2.5 sm:px-5 sm:py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-region="ì œì£¼">ì œì£¼</button>
            </div>
        </div>
    </div>

    <!-- ì •ë ¬ ì„ íƒ ëª¨ë‹¬ -->
    <div id="sort-modal"
        class="fixed inset-0 z-[9999] bg-transparent hidden opacity-0 transition-opacity duration-300 pointer-events-none">
        <!-- ë²„íŠ¼ê³¼ ëª¨ë‹¬ ì‚¬ì´ì˜ ë³´ì´ì§€ ì•ŠëŠ” ì—°ê²° ì˜ì—­ -->
        <div id="sort-modal-bridge" class="absolute pointer-events-auto" style="background: transparent;"></div>
        <div id="sort-modal-content"
            class="bg-white rounded-3xl shadow-2xl p-6 w-48 sm:w-48 transform scale-95 transition-transform duration-300 absolute pointer-events-auto">
            <div class="flex flex-col gap-2">
                <button
                    class="sort-option-btn w-full px-5 py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-sort="latest">ìµœì‹ ìˆœ</button>
                <button
                    class="sort-option-btn w-full px-5 py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-sort="popular">ì¸ê¸°ìˆœ</button>
                <button
                    class="sort-option-btn w-full px-5 py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-sort="deadline">ë§ˆê°ìˆœ</button>
                <button
                    class="sort-option-btn w-full px-5 py-2.5 rounded-full bg-white border border-gray-200 text-gray-600 text-sm font-bold hover:bg-[#DDDEF8] hover:text-gray-700 hover:border-[#DDDEF8] transition-all flex items-center justify-center gap-2"
                    data-sort="reset">ì›ë˜ëŒ€ë¡œ</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. ì„¤ì • ë° ìœ í‹¸ë¦¬í‹° ---
        const ITEMS_PER_PAGE = 8;
        let currentPage = 1;
        let currentCategoryFilter = 'all'; // í˜„ì¬ ì„ íƒëœ ì¹´í…Œê³ ë¦¬ í•„í„° ì €ì¥
        let currentRegionFilter = null; // í˜„ì¬ ì„ íƒëœ ì§€ì—­ í•„í„° ì €ì¥ (null = ì „ì²´)      

        const debounce = (func, delay) => {
            let timeoutId;
            return (...args) => {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => func(...args), delay);
            };
        };

        // --- 1-1. ìµœê·¼ ê²€ìƒ‰ì–´ ê´€ë¦¬ (localStorage) ---
        const RECENT_SEARCHES_KEY = 'recent_searches';
        const MAX_RECENT_SEARCHES = 5;

        // ìµœê·¼ ê²€ìƒ‰ì–´ ê°€ì ¸ì˜¤ê¸°
        function getRecentSearches() {
            try {
                const stored = localStorage.getItem(RECENT_SEARCHES_KEY);
                return stored ? JSON.parse(stored) : [];
            } catch (e) {
                console.error('ìµœê·¼ ê²€ìƒ‰ì–´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', e);
                return [];
            }
        }

        // ìµœê·¼ ê²€ìƒ‰ì–´ ì €ì¥í•˜ê¸°
        function saveRecentSearch(keyword) {
            if (!keyword || keyword.trim() === '') return;

            const trimmedKeyword = keyword.trim();
            let searches = getRecentSearches();

            // ì¤‘ë³µ ì œê±° (ê¸°ì¡´ í•­ëª©ì´ ìˆìœ¼ë©´ ì œê±°)
            searches = searches.filter(s => s !== trimmedKeyword);

            // ë§¨ ì•ì— ì¶”ê°€
            searches.unshift(trimmedKeyword);

            // ìµœëŒ€ ê°œìˆ˜ ì œí•œ
            if (searches.length > MAX_RECENT_SEARCHES) {
                searches = searches.slice(0, MAX_RECENT_SEARCHES);
            }

            try {
                localStorage.setItem(RECENT_SEARCHES_KEY, JSON.stringify(searches));
            } catch (e) {
                console.error('ìµœê·¼ ê²€ìƒ‰ì–´ ì €ì¥ ì‹¤íŒ¨:', e);
            }
        }

        // ìµœê·¼ ê²€ìƒ‰ì–´ ì‚­ì œí•˜ê¸°
        function deleteRecentSearch(keyword) {
            let searches = getRecentSearches();
            searches = searches.filter(s => s !== keyword);

            try {
                localStorage.setItem(RECENT_SEARCHES_KEY, JSON.stringify(searches));
            } catch (e) {
                console.error('ìµœê·¼ ê²€ìƒ‰ì–´ ì‚­ì œ ì‹¤íŒ¨:', e);
            }

            renderRecentSearches();
        }

        // ìµœê·¼ ê²€ìƒ‰ì–´ ì „ë¶€ ì‚­ì œí•˜ê¸°
        function clearAllRecentSearches() {
            try {
                localStorage.setItem(RECENT_SEARCHES_KEY, JSON.stringify([]));
                hideRecentSearches();
            } catch (e) {
                console.error('ìµœê·¼ ê²€ìƒ‰ì–´ ì „ë¶€ ì‚­ì œ ì‹¤íŒ¨:', e);
            }
        }

        // ìµœê·¼ ê²€ìƒ‰ì–´ ëª©ë¡ ë Œë”ë§
        function renderRecentSearches() {
            const recentSearchesList = document.getElementById('recent-searches-list');
            const recentSearchesContainer = document.getElementById('recent-searches');

            if (!recentSearchesList || !recentSearchesContainer) return;

            const searches = getRecentSearches();

            if (searches.length === 0) {
                recentSearchesContainer.classList.add('hidden');
                return;
            }

            recentSearchesList.innerHTML = '';

            searches.forEach(keyword => {
                const item = document.createElement('div');
                item.className = 'flex items-center justify-start px-3 py-2 hover:bg-gray-50 rounded-md cursor-pointer group';

                const keywordSpan = document.createElement('span');
                keywordSpan.className = 'text-sm text-gray-700';
                keywordSpan.textContent = keyword;
                keywordSpan.addEventListener('click', async () => {
                    const searchInput = document.getElementById('search-input');
                    if (searchInput) {
                        searchInput.value = keyword;
                        // ê²€ìƒ‰ ì‹¤í–‰
                        await renderCards(currentCategoryFilter, keyword, false, selectedSortValue);
                    }
                    hideRecentSearches();
                });

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'ml-2 text-gray-400 hover:text-gray-600 opacity-0 group-hover:opacity-100 transition-opacity';
                deleteBtn.innerHTML = '<i class="fa-solid fa-xmark text-xs"></i>';
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteRecentSearch(keyword);
                });

                item.appendChild(keywordSpan);
                item.appendChild(deleteBtn);
                recentSearchesList.appendChild(item);
            });
        }

        // ìµœê·¼ ê²€ìƒ‰ì–´ ëª©ë¡ í‘œì‹œ (ì €ì¥ëœ ê²€ìƒ‰ì–´ê°€ 1ê°œ ì´ìƒì¼ ë•Œ í‘œì‹œ)
        function showRecentSearches() {
            const recentSearchesContainer = document.getElementById('recent-searches');
            if (recentSearchesContainer) {
                const searches = getRecentSearches();
                // ê²€ìƒ‰ì–´ê°€ 1ê°œ ì´ìƒ ì €ì¥ë˜ì–´ ìˆìœ¼ë©´ í‘œì‹œ (ì²˜ìŒ ê²€ìƒ‰ í›„ë¶€í„° ì´ì „ ê²€ìƒ‰ì–´ê°€ ìˆìœ¼ë©´ í‘œì‹œ)
                if (searches.length >= 1) {
                    renderRecentSearches();
                    recentSearchesContainer.classList.remove('hidden');
                } else {
                    recentSearchesContainer.classList.add('hidden');
                }
            }
        }

        // ìµœê·¼ ê²€ìƒ‰ì–´ ëª©ë¡ ìˆ¨ê¹€
        function hideRecentSearches() {
            const recentSearchesContainer = document.getElementById('recent-searches');
            if (recentSearchesContainer) {
                recentSearchesContainer.classList.add('hidden');
            }
        }

        // --- 2. ì¹´í…Œê³ ë¦¬ ìƒ‰ìƒ ë§¤í•‘ (ì´ë¯¸ì§€ ë§¤í•‘ìš©) ---
        const categoryMap = {
            "ì£¼ê±°": "housing", "ì£¼ê±°/ìë¦½": "housing",
            "ì·¨ì—…": "job", "ì·¨ì—…/ì§ë¬´": "job",
            "ê¸ˆìœµ": "finance", "ê¸ˆìœµ/ìƒí™œë¹„": "finance",
            "ë³µì§€": "welfare", "ë³µì§€/ë¬¸í™”": "welfare",
            "ì°½ì—…": "startup", "ì°½ì—…/ì‚¬ì—…": "startup",
            "êµìœ¡": "growth", "êµìœ¡/ìê²©ì¦": "growth"
        };

        // --- 2-1. APIì—ì„œ ì •ì±… ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ---
        let policyData = [];

        async function fetchPolicyData(category = "all", keyword = "", sort = null, region = null) {
            const loadingIndicator = document.getElementById('loading-indicator');
            if (loadingIndicator) loadingIndicator.classList.remove('hidden');

            try {
                // API í˜¸ì¶œ íŒŒë¼ë¯¸í„° êµ¬ì„±
                const params = new URLSearchParams();
                // ì „ì²´ë³´ê¸° í˜ì´ì§€ì—ì„œëŠ” category=allì„ ëª…ì‹œì ìœ¼ë¡œ ì „ë‹¬í•˜ì—¬ ê²€ìƒ‰/ì „ì²´ë³´ê¸° ë¡œì§ìœ¼ë¡œ ì²˜ë¦¬
                if (category) {
                    params.append('category', category);
                }
                if (keyword) {
                    params.append('keyword', keyword);
                }
                if (sort) {
                    params.append('sort', sort);
                }
                // ì „ì²´ ì„ íƒ ì‹œ region íŒŒë¼ë¯¸í„°ë¥¼ ì „ë‹¬í•˜ì§€ ì•ŠìŒ (nullì´ë©´ ì „ë‹¬ ì•ˆ í•¨)
                if (region && region !== 'ì „ì²´') {
                    params.append('region', region);
                }

                const url = `/api/cards?${params.toString()}`;
                console.log(`ğŸŒ API í˜¸ì¶œ: ${url}`);
                console.log(`   - ì¹´í…Œê³ ë¦¬: ${category}`);
                console.log(`   - ê²€ìƒ‰ì–´: ${keyword}`);
                console.log(`   - ì§€ì—­: ${region || 'ì „ì²´'}`);
                console.log(`   - ì •ë ¬: ${sort}`);

                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                // API ì‘ë‹µì´ ë°°ì—´ì¸ì§€ í™•ì¸
                if (!Array.isArray(data)) {
                    console.error('API ì‘ë‹µì´ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤:', data);
                    policyData = [];
                    return [];
                }

                // ë°˜í™˜ëœ ë°ì´í„°ì˜ ì¹´í…Œê³ ë¦¬ ë¶„í¬ í™•ì¸
                if (data.length > 0) {
                    const categoryDist = {};
                    data.forEach(item => {
                        const cat = item.category || 'Unknown';
                        categoryDist[cat] = (categoryDist[cat] || 0) + 1;
                    });
                    console.log(`ğŸ“Š API ì‘ë‹µ ì¹´í…Œê³ ë¦¬ ë¶„í¬:`, categoryDist);
                }

                // API ì‘ë‹µ ë°ì´í„°ë¥¼ í”„ë¡ íŠ¸ì—”ë“œ í˜•ì‹ìœ¼ë¡œ ë§¤í•‘
                policyData = data.map(item => {
                    try {
                        // ì¹´í…Œê³ ë¦¬ì— ë§ëŠ” ì´ë¯¸ì§€ ê²½ë¡œ ìƒì„±
                        const prefix = categoryMap[item.category] || "welfare";
                        const imgIndex = ((item.id || 1) % 5) + 1; // ID ê¸°ë°˜ìœ¼ë¡œ ì´ë¯¸ì§€ ì„ íƒ

                        return {
                            id: item.id || 0,
                            title: item.title || "",
                            desc: item.desc || item.summary || "ìƒì„¸ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”.",
                            category: item.category || item.genre || "ê¸°íƒ€",
                            date: item.date || "ìƒì‹œ ëª¨ì§‘",
                            image: item.image || `/static/images/card_images/${prefix}_${imgIndex}.webp`,
                            link: item.link || "#",
                            colorCode: item.colorCode || "#777777",
                            img: item.image || `/static/images/card_images/${prefix}_${imgIndex}.webp`
                        };
                    } catch (itemError) {
                        console.error('ì•„ì´í…œ ë§¤í•‘ ì˜¤ë¥˜:', itemError, item);
                        return null;
                    }
                }).filter(item => item !== null); // null í•­ëª© ì œê±°

                console.log(`âœ… ë°ì´í„° ë¡œë“œ ì™„ë£Œ: ì´ ${policyData.length}ê°œì˜ ì •ì±… (ì˜ˆìƒ í˜ì´ì§€: ${Math.ceil(policyData.length / ITEMS_PER_PAGE)}í˜ì´ì§€)`);

                return policyData;
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                policyData = [];
                return [];
            } finally {
                if (loadingIndicator) loadingIndicator.classList.add('hidden');
            }
        }

        // --- 3. 3D íš¨ê³¼ í•¨ìˆ˜ ---
        function init3DEffect() {
            if (window.innerWidth < 768) return;
            const wrappers = document.querySelectorAll('.perspective-wrap');

            wrappers.forEach(wrapper => {
                if (wrapper.dataset.gsapInitialized) return;
                wrapper.dataset.gsapInitialized = "true";

                const lifter = wrapper.querySelector('.card-lifter');
                const card = wrapper.querySelector('.policy-card');
                const cardImage = wrapper.querySelector('.card-image img');
                const borderColor = card.dataset.color;

                wrapper.addEventListener('mouseenter', () => {
                    gsap.set(wrapper, { zIndex: 50 });
                    gsap.to(lifter, { y: -12, scale: 1.05, duration: 0.4, ease: "back.out(1.4)", overwrite: "auto" });
                    gsap.to(card, { borderColor: borderColor, boxShadow: "0 20px 40px -5px rgba(0,0,0,0.2)", duration: 0.3 });
                });

                wrapper.addEventListener('mousemove', (e) => {
                    const rect = wrapper.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    const centerX = rect.width / 2;
                    const centerY = rect.height / 2;
                    const rotateX = ((y - centerY) / centerY) * -5;
                    const rotateY = ((x - centerX) / centerX) * 5;

                    gsap.to(card, { rotateX: rotateX, rotateY: rotateY, duration: 0.1, ease: "power1.out", overwrite: "auto" });
                    if (cardImage) gsap.to(cardImage, { x: (x - centerX) * 0.05, y: (y - centerY) * 0.05, duration: 1.0, ease: "power2.out" });
                });

                wrapper.addEventListener('mouseleave', () => {
                    gsap.delayedCall(0.3, () => gsap.set(wrapper, { zIndex: 1 }));
                    gsap.to(lifter, { y: 0, scale: 1, duration: 1.0, ease: "power3.out" });
                    gsap.to(card, { rotateX: 0, rotateY: 0, borderColor: '#e5e7eb', boxShadow: "0 1px 2px 0 rgba(0, 0, 0, 0.05)", duration: 0.3, ease: "power3.out" });
                    if (cardImage) gsap.to(cardImage, { x: 0, y: 0, duration: 0.3 });
                });
            });
        }

        function playEntranceAnimation() {
            const cardLifters = document.querySelectorAll(".card-lifter");
            if (cardLifters.length === 0) {
                console.warn("playEntranceAnimation: .card-lifter ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }
            gsap.from(".card-lifter", {
                y: 50, opacity: 0, duration: 0.6, stagger: 0.05, ease: "power2.out", clearProps: "all"
            });
        }

        // --- 4. í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§ í•¨ìˆ˜ (ìŠ¤ë§ˆíŠ¸ í˜ì´ì§€ë„¤ì´ì…˜) ---
        function renderPagination(totalItems) {
            const paginationContainer = document.getElementById('pagination-container');
            paginationContainer.innerHTML = "";

            const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);
            console.log(`ğŸ“„ í˜ì´ì§€ë„¤ì´ì…˜: ì´ ${totalItems}ê°œ í•­ëª©, ${totalPages}í˜ì´ì§€ ìƒì„±`);
            if (totalPages <= 1) return;

            const baseClass = "w-10 h-10 rounded-full text-sm font-bold transition-all flex items-center justify-center border";
            const activeClass = `${baseClass} bg-[#777777] text-white border-[#777777] shadow-md transform scale-105`;
            const inactiveClass = `${baseClass} bg-white text-gray-500 border-gray-200 hover:bg-gray-100 hover:text-primary-teal`;
            const navClass = "px-4 h-10 rounded-full text-sm font-bold transition-all flex items-center justify-center border bg-white text-gray-500 border-gray-200 hover:bg-gray-100 hover:text-primary-teal";

            // í˜ì´ì§€ ë²ˆí˜¸ë¥¼ í´ë¦­í–ˆì„ ë•Œ ì‹¤í–‰í•  í•¨ìˆ˜
            const handlePageClick = async (pageNum) => {
                currentPage = pageNum;
                const currentCategory = currentCategoryFilter || 'all';
                const keyword = document.getElementById('search-input') ? document.getElementById('search-input').value : '';
                const currentSort = selectedSortValue;

                console.log(`ğŸ“„ í˜ì´ì§€ ${pageNum} í´ë¦­:`);
                console.log(`   - ì¹´í…Œê³ ë¦¬: ${currentCategory}`);
                console.log(`   - ê²€ìƒ‰ì–´: ${keyword}`);
                console.log(`   - ì •ë ¬: ${currentSort}`);

                await renderCards(currentCategory, keyword, true, currentSort);
            };

            // ì´ì „ ë²„íŠ¼
            if (currentPage > 1) {
                const prevBtn = document.createElement('button');
                prevBtn.innerText = 'ì´ì „';
                prevBtn.className = navClass;
                prevBtn.addEventListener('click', async () => {
                    await handlePageClick(currentPage - 1);
                });
                paginationContainer.appendChild(prevBtn);
            }

            // í˜ì´ì§€ ë²ˆí˜¸ í‘œì‹œ ë¡œì§
            const delta = 2; // í˜„ì¬ í˜ì´ì§€ ì–‘ì˜†ì— í‘œì‹œí•  í˜ì´ì§€ ìˆ˜
            let startPage = Math.max(1, currentPage - delta);
            let endPage = Math.min(totalPages, currentPage + delta);

            // ì²« í˜ì´ì§€ê°€ í‘œì‹œë˜ì§€ ì•Šìœ¼ë©´ ì¶”ê°€
            if (startPage > 1) {
                const firstBtn = document.createElement('button');
                firstBtn.innerText = '1';
                firstBtn.className = currentPage === 1 ? activeClass : inactiveClass;
                firstBtn.addEventListener('click', async () => await handlePageClick(1));
                paginationContainer.appendChild(firstBtn);

                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.innerText = '...';
                    ellipsis.className = "px-2 text-gray-500";
                    paginationContainer.appendChild(ellipsis);
                }
            }

            // í˜„ì¬ í˜ì´ì§€ ì£¼ë³€ í˜ì´ì§€ë“¤ í‘œì‹œ
            for (let i = startPage; i <= endPage; i++) {
                const btn = document.createElement('button');
                btn.innerText = i;
                btn.className = i === currentPage ? activeClass : inactiveClass;
                btn.addEventListener('click', async () => await handlePageClick(i));
                paginationContainer.appendChild(btn);
            }

            // ë§ˆì§€ë§‰ í˜ì´ì§€ê°€ í‘œì‹œë˜ì§€ ì•Šìœ¼ë©´ ì¶”ê°€
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.innerText = '...';
                    ellipsis.className = "px-2 text-gray-500";
                    paginationContainer.appendChild(ellipsis);
                }

                const lastBtn = document.createElement('button');
                lastBtn.innerText = totalPages;
                lastBtn.className = currentPage === totalPages ? activeClass : inactiveClass;
                lastBtn.addEventListener('click', async () => await handlePageClick(totalPages));
                paginationContainer.appendChild(lastBtn);
            }

            // ë‹¤ìŒ ë²„íŠ¼
            if (currentPage < totalPages) {
                const nextBtn = document.createElement('button');
                nextBtn.innerText = 'ë‹¤ìŒ';
                nextBtn.className = navClass;
                nextBtn.addEventListener('click', async () => {
                    await handlePageClick(currentPage + 1);
                });
                paginationContainer.appendChild(nextBtn);
            }
        }

        // --- 5. ì¹´ë“œ ë Œë”ë§ í•¨ìˆ˜ ---
        async function renderCards(filterCategory = "all", keyword = "", isPageChange = false, sortValue = null) {
            const container = document.getElementById('card-container');
            const noResult = document.getElementById('no-result');

            // ì§€ì—­ í•„í„° ê°€ì ¸ì˜¤ê¸°
            const regionFilter = currentRegionFilter;

            console.log(`ğŸ”„ renderCards í˜¸ì¶œ: ì¹´í…Œê³ ë¦¬=${filterCategory}, ê²€ìƒ‰ì–´=${keyword}, ì§€ì—­=${regionFilter || 'ì „ì²´'}, í˜ì´ì§€ë³€ê²½=${isPageChange}, ì •ë ¬=${sortValue}`);

            // APIì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì •ë ¬ ë° ì§€ì—­ íŒŒë¼ë¯¸í„° í¬í•¨)
            await fetchPolicyData(filterCategory, keyword, sortValue, regionFilter);

            if (!isPageChange) currentPage = 1;

            const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
            const endIndex = startIndex + ITEMS_PER_PAGE;
            const visibleData = policyData.slice(startIndex, endIndex);

            if (policyData.length === 0) {
                container.innerHTML = "";
                document.getElementById('pagination-container').innerHTML = "";
                if (noResult) noResult.classList.remove('hidden');
                return;
            }
            if (noResult) noResult.classList.add('hidden');

            container.innerHTML = visibleData.map(item => {
                // [ë³€ê²½] main.htmlê³¼ ë™ì¼í•œ ë°©ì‹ (HTML ì—”í‹°í‹° ì´ìŠ¤ì¼€ì´í”„)
                const itemJson = JSON.stringify(item).replace(/"/g, '&quot;');
                return `
                <div class="perspective-wrap h-full cursor-pointer group" onclick="openCardModal(this)" data-json="${itemJson}" style="z-index: 1;">
                    <div class="card-lifter">
                        <div class="policy-card relative bg-white rounded-xl overflow-hidden h-full flex flex-col border border-gray-100 shadow-sm transition-colors"
                             data-color="${item.colorCode}">
                            <div class="card-image w-full bg-white flex items-end justify-center shrink-0 h-[200px] overflow-hidden relative">
                                <img src="${item.img}" alt="${item.title}" class="w-full h-full object-cover" onerror="this.src='/static/images/card_images/default.png'">
                            </div>
                            <div class="card-content text-left bg-white flex-grow flex flex-col justify-between p-5 z-20 relative">
                                <div>
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-xs font-bold text-primary-orange bg-orange-100 px-2 py-0.5 rounded">#${item.category || 'ê¸°íƒ€'}</span>
                                    </div>
                                    <h3 class="card-title mb-2 line-clamp-1 text-xl font-extrabold text-[#222] group-hover:text-primary-teal transition-colors">${item.title}</h3>
                                    <p class="card-desc line-clamp-2 text-sm text-[#666] font-medium leading-relaxed">${item.desc || 'ìƒì„¸ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”.'}</p>
                                </div>
                                <div class="card-date flex justify-between items-center mt-4 text-xs text-[#888] border-t pt-3 border-gray-100">
                                    <span>${item.date || 'ìƒì‹œ ëª¨ì§‘'}</span>
                                    <i class="fa-solid fa-arrow-right text-gray-300 group-hover:text-primary-teal transition-transform group-hover:translate-x-1"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;
            }).join('');

            renderPagination(policyData.length);

            // DOM ì—…ë°ì´íŠ¸ í›„ ì‹¤í–‰ë˜ë„ë¡ requestAnimationFrame ì‚¬ìš©
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    init3DEffect();
                    // ìš”ì†Œê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ í›„ ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
                    const cardLifters = document.querySelectorAll('.card-lifter');
                    if (cardLifters.length > 0) {
                        playEntranceAnimation();
                    }
                });
            });

            if (isPageChange) window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- DOMContentLoaded: ëª¨ë“  ë¡œì§ ---
        document.addEventListener('DOMContentLoaded', async () => {
            currentCategoryFilter = 'all'; // ì´ˆê¸° ì¹´í…Œê³ ë¦¬ ì„¤ì •
            currentRegionFilter = null; // ì´ˆê¸° ì§€ì—­ í•„í„° ì„¤ì • (ì „ì²´)
            await renderCards("all", "", false);

            const searchInput = document.getElementById('search-input');
            const clearBtn = document.getElementById('clear-btn');
            const filterBtns = document.querySelectorAll('.filter-btn');

            if (searchInput && clearBtn) {
                const toggleClearBtn = () => {
                    if (searchInput.value.length > 0) clearBtn.classList.remove('hidden');
                    else clearBtn.classList.add('hidden');
                };
                searchInput.addEventListener('input', toggleClearBtn);
                clearBtn.addEventListener('click', async () => {
                    searchInput.value = '';
                    toggleClearBtn();
                    searchInput.focus();
                    // ì €ì¥ëœ ì¹´í…Œê³ ë¦¬ í•„í„° ì‚¬ìš©
                    await renderCards(currentCategoryFilter, '', false);
                });
            }

            if (searchInput) {
                // ì—”í„° í‚¤ ì…ë ¥ ì‹œ ê²€ìƒ‰ì–´ ì €ì¥ ë° ê²€ìƒ‰ ì‹¤í–‰
                searchInput.addEventListener('keydown', async (e) => {
                    if (e.key === 'Enter') {
                        const keyword = searchInput.value.trim();
                        if (keyword) {
                            saveRecentSearch(keyword);
                            hideRecentSearches();
                            await renderCards(currentCategoryFilter, keyword, false, selectedSortValue);
                        }
                    }
                });

                // ì…ë ¥ ì‹œ ìµœê·¼ ê²€ìƒ‰ì–´ í‘œì‹œ (ì¦‰ì‹œ ì‹¤í–‰)
                searchInput.addEventListener('input', (e) => {
                    const keyword = e.target.value.trim();

                    // ì…ë ¥ê°’ì´ ë¹„ì–´ìˆìœ¼ë©´ ëª©ë¡ ìˆ¨ê¹€
                    if (keyword === '') {
                        hideRecentSearches();
                    } else {
                        // ì…ë ¥ê°’ì´ ìˆìœ¼ë©´ ìµœê·¼ ê²€ìƒ‰ì–´ í‘œì‹œ
                        showRecentSearches();
                    }
                });

                // ì…ë ¥ ì‹œ ê²€ìƒ‰ ì‹¤í–‰ (debounce) - ì €ì¥í•˜ì§€ ì•ŠìŒ (ì—”í„° í‚¤ë‚˜ ëª…ì‹œì  ê²€ìƒ‰ ì‹œì—ë§Œ ì €ì¥)
                searchInput.addEventListener('input', debounce(async (e) => {
                    const keyword = e.target.value.trim();
                    // ì €ì¥ëœ ì¹´í…Œê³ ë¦¬ í•„í„° ì‚¬ìš©
                    await renderCards(currentCategoryFilter, keyword, false);
                }, 300));
            }

            // ì „ë¶€ ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            const clearAllSearchesBtn = document.getElementById('clear-all-searches');
            if (clearAllSearchesBtn) {
                clearAllSearchesBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    clearAllRecentSearches();
                });
            }

            // ê²€ìƒ‰ì°½ ë°– í´ë¦­ ì‹œ ìµœê·¼ ê²€ìƒ‰ì–´ ëª©ë¡ ìˆ¨ê¹€
            document.addEventListener('click', (e) => {
                const searchInput = document.getElementById('search-input');
                const recentSearchesContainer = document.getElementById('recent-searches');

                if (searchInput && recentSearchesContainer) {
                    // ê²€ìƒ‰ì°½ì´ë‚˜ ìµœê·¼ ê²€ìƒ‰ì–´ ëª©ë¡ ë‚´ë¶€ í´ë¦­ì´ ì•„ë‹Œ ê²½ìš°
                    if (!searchInput.contains(e.target) && !recentSearchesContainer.contains(e.target)) {
                        hideRecentSearches();
                    }
                }
            });

            filterBtns.forEach(btn => {
                btn.addEventListener('click', async () => {
                    filterBtns.forEach(b => {
                        b.classList.remove('bg-[#777777]', 'text-white');
                        b.classList.add('bg-white', 'text-gray-600', 'border');
                    });
                    btn.classList.remove('bg-white', 'text-gray-600', 'border');
                    btn.classList.add('bg-[#777777]', 'text-white', 'active');

                    // í˜„ì¬ ì¹´í…Œê³ ë¦¬ í•„í„° ì €ì¥
                    currentCategoryFilter = btn.dataset.category || 'all';
                    console.log(`ğŸ·ï¸ ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ í´ë¦­: ${currentCategoryFilter}`);

                    const keyword = searchInput ? searchInput.value : "";
                    const currentSort = selectedSortValue; // ì •ë ¬ ìƒíƒœ ìœ ì§€
                    await renderCards(currentCategoryFilter, keyword, false, currentSort);
                });
            });

            const filterContainer = document.getElementById('category-filters');
            const leftBtn = document.getElementById('scroll-left');
            const rightBtn = document.getElementById('scroll-right');

            if (filterContainer && leftBtn && rightBtn) {
                const updateArrows = () => {
                    const scrollLeft = filterContainer.scrollLeft;
                    const maxScroll = filterContainer.scrollWidth - filterContainer.clientWidth;
                    if (scrollLeft > 10) leftBtn.classList.remove('opacity-0', 'pointer-events-none');
                    else leftBtn.classList.add('opacity-0', 'pointer-events-none');

                    if (scrollLeft < maxScroll - 10) rightBtn.classList.remove('opacity-0', 'pointer-events-none');
                    else rightBtn.classList.add('opacity-0', 'pointer-events-none');
                };

                leftBtn.addEventListener('click', () => filterContainer.scrollBy({ left: -200, behavior: 'smooth' }));
                rightBtn.addEventListener('click', () => filterContainer.scrollBy({ left: 200, behavior: 'smooth' }));
                filterContainer.addEventListener('scroll', debounce(updateArrows, 50));

                updateArrows();
                window.addEventListener('resize', updateArrows);

                filterBtns.forEach(btn => {
                    btn.addEventListener('click', function () {
                        if (window.innerWidth < 640) {
                            const containerRect = filterContainer.getBoundingClientRect();
                            const btnRect = this.getBoundingClientRect();
                            const offset = btnRect.left - containerRect.left - (containerRect.width / 2) + (btnRect.width / 2);
                            filterContainer.scrollBy({ left: offset, behavior: 'smooth' });
                        }
                    });
                });
            }
        });

        function openCardModal(element) {
            console.log("ëª¨ë‹¬ ì—´ê¸°:", element.dataset.json);
        }

        // ì§€ì—­ ì„ íƒ ëª¨ë‹¬ ê¸°ëŠ¥
        const regionBtn = document.getElementById('region-btn');
        const regionModal = document.getElementById('region-modal');
        const regionModalClose = document.getElementById('region-modal-close');
        const regionOptionBtns = document.querySelectorAll('.region-option-btn');
        let selectedRegionValue = null; // ì„ íƒëœ ì§€ì—­ ì €ì¥

        // ëª¨ë“  ì§€ì—­ ë²„íŠ¼ì˜ ì„ íƒ ìƒíƒœ ì´ˆê¸°í™”
        function clearRegionSelection() {
            regionOptionBtns.forEach(btn => {
                btn.classList.remove('bg-cyan-50', 'text-cyan-500', 'border-cyan-500');
                btn.classList.add('bg-white', 'text-gray-600', 'border-gray-200');
                // ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ì œê±°
                btn.style.backgroundColor = '';
                btn.style.color = '';
                btn.style.borderColor = '';
            });
        }

        // íŠ¹ì • ì§€ì—­ ë²„íŠ¼ì„ ì„ íƒ ìƒíƒœë¡œ í‘œì‹œ
        function setRegionSelection(region) {
            clearRegionSelection();
            const targetBtn = Array.from(regionOptionBtns).find(btn => btn.dataset.region === region);
            if (targetBtn && regionBtn) {
                // region-btnì˜ í˜„ì¬ ë°°ê²½ìƒ‰ ê°€ì ¸ì˜¤ê¸°
                const computedStyle = window.getComputedStyle(regionBtn);
                const regionBtnBgColor = computedStyle.backgroundColor || 'rgba(255, 255, 255, 1)';

                // region-btnê³¼ ë™ì¼í•œ ìƒ‰ìƒ ì ìš©
                targetBtn.classList.remove('bg-white', 'text-gray-600', 'border-gray-200');
                targetBtn.style.backgroundColor = regionBtnBgColor;
                targetBtn.style.color = computedStyle.color || 'rgba(81, 82, 81, 1)';
                targetBtn.style.borderColor = computedStyle.borderColor || '#e5e7eb';
            }
        }

        function openRegionModal() {
            if (!regionModal) return;
            regionModal.classList.remove('hidden');
            // ëª¨ë‹¬ì„ ì—´ ë•Œ ì´ì „ ì„ íƒ ìƒíƒœ ë³µì›
            if (selectedRegionValue) {
                setRegionSelection(selectedRegionValue);
            }
            setTimeout(() => {
                regionModal.classList.remove('opacity-0');
                const modalContent = regionModal.querySelector('.bg-white');
                if (modalContent) {
                    modalContent.classList.remove('scale-95');
                    modalContent.classList.add('scale-100');
                }
            }, 10);
        }

        function closeRegionModal() {
            if (!regionModal) return;
            regionModal.classList.add('opacity-0');
            const modalContent = regionModal.querySelector('.bg-white');
            if (modalContent) {
                modalContent.classList.remove('scale-100');
                modalContent.classList.add('scale-95');
            }
            setTimeout(() => {
                regionModal.classList.add('hidden');
            }, 300);
        }

        if (regionBtn && regionModal) {
            regionBtn.addEventListener('click', openRegionModal);
        }

        if (regionModalClose) {
            regionModalClose.addEventListener('click', closeRegionModal);
        }

        // ë°°ê²½ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
        if (regionModal) {
            regionModal.addEventListener('click', (e) => {
                if (e.target === regionModal) {
                    closeRegionModal();
                }
            });
        }

        // ì§€ì—­ ì„ íƒ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        if (regionOptionBtns.length > 0) {
            regionOptionBtns.forEach(btn => {
                btn.addEventListener('click', async () => {
                    const selectedRegion = btn.dataset.region;
                    console.log('ì„ íƒëœ ì§€ì—­:', selectedRegion);

                    // ì„ íƒëœ ì§€ì—­ ì €ì¥
                    selectedRegionValue = selectedRegion;

                    // ì§€ì—­ í•„í„° ì—…ë°ì´íŠ¸
                    if (selectedRegion === 'ì „ì²´') {
                        // ì „ì²´ ì„ íƒ ì‹œ: ëª¨ë“  ì§€ì—­ì˜ ì •ì±… í‘œì‹œ (í•„í„° ì—†ìŒ)
                        currentRegionFilter = null;
                    } else {
                        // íŠ¹ì • ì§€ì—­ ì„ íƒ ì‹œ: í•´ë‹¹ ì§€ì—­ì˜ ì •ì±…ë§Œ í‘œì‹œ
                        currentRegionFilter = selectedRegion;
                    }

                    // ì„ íƒëœ ë²„íŠ¼ì— ìŠ¤íƒ€ì¼ ì ìš©
                    setRegionSelection(selectedRegion);

                    // ì§€ì—­ ë²„íŠ¼ì˜ í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•œ ì§€ì—­ ì´ë¦„ìœ¼ë¡œ ë³€ê²½ ë° ë°°ê²½ìƒ‰ ë³€ê²½
                    if (regionBtn) {
                        const displayText = selectedRegion === 'ì „ì²´' ? 'ì§€ì—­' : selectedRegion;
                        regionBtn.innerHTML = `<i class="fa-solid fa-map"></i> ${displayText}`;
                        // ì „ì²´ ì„ íƒ ì‹œ ë°°ê²½ìƒ‰ ì´ˆê¸°í™”, íŠ¹ì • ì§€ì—­ ì„ íƒ ì‹œ ìƒ‰ìƒ ì ìš©
                        if (selectedRegion === 'ì „ì²´') {
                            regionBtn.style.backgroundColor = '';
                        } else {
                            regionBtn.style.backgroundColor = 'rgba(221, 222, 248, 1)';
                        }
                    }

                    closeRegionModal();

                    // ì§€ì—­ ì„ íƒ ì‹œ ì¹´ë“œ ë‹¤ì‹œ ë Œë”ë§ (í˜„ì¬ ì¹´í…Œê³ ë¦¬ì™€ ì •ë ¬ ìœ ì§€)
                    const currentCategory = currentCategoryFilter || 'all';
                    const keyword = document.getElementById('search-input') ? document.getElementById('search-input').value : '';
                    const currentSort = selectedSortValue;
                    currentPage = 1; // 1í˜ì´ì§€ë¡œ ë¦¬ì…‹

                    console.log(`ğŸ—ºï¸ ì§€ì—­ í•„í„° ì ìš©: ${currentRegionFilter || 'ì „ì²´'}, ì¹´í…Œê³ ë¦¬=${currentCategory}, ì •ë ¬=${currentSort}`);
                    await renderCards(currentCategory, keyword, false, currentSort);
                });
            });
        }

        // ì •ë ¬ ì„ íƒ ëª¨ë‹¬ ê¸°ëŠ¥
        const sortBtn = document.getElementById('sort-btn');
        const sortModal = document.getElementById('sort-modal');
        const sortOptionBtns = document.querySelectorAll('.sort-option-btn');
        let selectedSortValue = null; // ì„ íƒëœ ì •ë ¬ ë°©ì‹ ì €ì¥
        let sortModalTimeout = null; // ëª¨ë‹¬ ë‹«ê¸° íƒ€ì´ë¨¸

        // ëª¨ë“  ì •ë ¬ ë²„íŠ¼ì˜ ì„ íƒ ìƒíƒœ ì´ˆê¸°í™”
        function clearSortSelection() {
            sortOptionBtns.forEach(btn => {
                btn.classList.remove('bg-green-50', 'text-green-500', 'border-green-500');
                btn.classList.add('bg-white', 'text-gray-600', 'border-gray-200');
                btn.style.backgroundColor = '';
                btn.style.color = '';
                btn.style.borderColor = '';
            });
        }

        // íŠ¹ì • ì •ë ¬ ë²„íŠ¼ì„ ì„ íƒ ìƒíƒœë¡œ í‘œì‹œ
        function setSortSelection(sort) {
            clearSortSelection();
            const targetBtn = Array.from(sortOptionBtns).find(btn => btn.dataset.sort === sort);
            if (targetBtn && sortBtn) {
                // sort-btnì˜ í˜„ì¬ ë°°ê²½ìƒ‰ ê°€ì ¸ì˜¤ê¸°
                const computedStyle = window.getComputedStyle(sortBtn);
                const sortBtnBgColor = computedStyle.backgroundColor || 'rgba(255, 255, 255, 1)';

                // sort-btnê³¼ ë™ì¼í•œ ìƒ‰ìƒ ì ìš©
                targetBtn.classList.remove('bg-white', 'text-gray-600', 'border-gray-200');
                targetBtn.style.backgroundColor = sortBtnBgColor;
                targetBtn.style.color = computedStyle.color || 'rgba(81, 82, 81, 1)';
                targetBtn.style.borderColor = computedStyle.borderColor || '#e5e7eb';
            }
        }

        function openSortModal() {
            if (!sortModal || !sortBtn) return;
            // ê¸°ì¡´ íƒ€ì´ë¨¸ ì·¨ì†Œ
            if (sortModalTimeout) {
                clearTimeout(sortModalTimeout);
                sortModalTimeout = null;
            }

            const rect = sortBtn.getBoundingClientRect();
            const modalContent = document.getElementById('sort-modal-content');
            const modalBridge = document.getElementById('sort-modal-bridge');
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            const modalWidth = 192; // w-48 = 192px
            const modalHeight = modalContent ? modalContent.offsetHeight : 200;

            if (modalContent) {
                // ëª¨ë°”ì¼ (640px ì´í•˜): ë²„íŠ¼ ì•„ë˜ ì¤‘ì•™ ì •ë ¬
                if (windowWidth <= 640) {
                    // ëª¨ë°”ì¼ì—ì„œëŠ” ëª¨ë‹¬ ë„ˆë¹„ë¥¼ í™”ë©´ì— ë§ê²Œ ì¡°ì •
                    const mobileModalWidth = Math.min(modalWidth, windowWidth - 32); // ì–‘ìª½ 16px ì—¬ë°±
                    modalContent.style.width = `${mobileModalWidth}px`;

                    const leftPosition = rect.left + (rect.width / 2) - (mobileModalWidth / 2);
                    const topPosition = rect.bottom + 8; // ë²„íŠ¼ ì•„ë˜ 8px

                    // í™”ë©´ ì™¼ìª½ ê²½ê³„ ì²´í¬
                    const finalLeft = Math.max(16, Math.min(leftPosition, windowWidth - mobileModalWidth - 16));
                    // í™”ë©´ ì•„ë˜ìª½ ê²½ê³„ ì²´í¬ - í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ë²„íŠ¼ ìœ„ì— í‘œì‹œ
                    const finalTop = (topPosition + modalHeight > windowHeight - 16)
                        ? rect.top - modalHeight - 8
                        : topPosition;

                    modalContent.style.top = `${finalTop}px`;
                    modalContent.style.left = `${finalLeft}px`;
                    modalContent.style.right = 'auto';
                }
                // íƒœë¸”ë¦¿ (641px ~ 1024px): ê°€ëŠ¥í•˜ë©´ ì˜¤ë¥¸ìª½, ì•ˆë˜ë©´ ì™¼ìª½
                else if (windowWidth <= 1024) {
                    modalContent.style.width = `${modalWidth}px`; // ì›ë˜ ë„ˆë¹„ ìœ ì§€
                    const rightSpace = windowWidth - rect.right;
                    const leftSpace = rect.left;

                    if (rightSpace >= modalWidth + 8) {
                        // ì˜¤ë¥¸ìª½ì— ê³µê°„ì´ ìˆìœ¼ë©´ ì˜¤ë¥¸ìª½ì— í‘œì‹œ
                        modalContent.style.top = `${rect.top}px`;
                        modalContent.style.left = `${rect.right + 8}px`;
                        modalContent.style.right = 'auto';
                    } else if (leftSpace >= modalWidth + 8) {
                        // ì™¼ìª½ì— ê³µê°„ì´ ìˆìœ¼ë©´ ì™¼ìª½ì— í‘œì‹œ
                        modalContent.style.top = `${rect.top}px`;
                        modalContent.style.left = 'auto';
                        modalContent.style.right = `${windowWidth - rect.left + 8}px`;
                    } else {
                        // ì–‘ìª½ ëª¨ë‘ ê³µê°„ì´ ì—†ìœ¼ë©´ ë²„íŠ¼ ì•„ë˜ ì¤‘ì•™
                        const leftPosition = rect.left + (rect.width / 2) - (modalWidth / 2);
                        modalContent.style.top = `${rect.bottom + 8}px`;
                        modalContent.style.left = `${Math.max(8, Math.min(leftPosition, windowWidth - modalWidth - 8))}px`;
                        modalContent.style.right = 'auto';
                    }
                }
                // PC (1024px ì´ìƒ): ì˜¤ë¥¸ìª½ì— í‘œì‹œ, í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ì¡°ì •
                else {
                    modalContent.style.width = `${modalWidth}px`; // ì›ë˜ ë„ˆë¹„ ìœ ì§€
                    const rightSpace = windowWidth - rect.right;

                    if (rightSpace >= modalWidth + 8) {
                        // ì˜¤ë¥¸ìª½ì— ì¶©ë¶„í•œ ê³µê°„ì´ ìˆìœ¼ë©´ ì˜¤ë¥¸ìª½ì— í‘œì‹œ
                        modalContent.style.top = `${rect.top}px`;
                        modalContent.style.left = `${rect.right + 8}px`;
                        modalContent.style.right = 'auto';
                    } else {
                        // ì˜¤ë¥¸ìª½ ê³µê°„ì´ ë¶€ì¡±í•˜ë©´ ë²„íŠ¼ ì™¼ìª½ì— í‘œì‹œ
                        modalContent.style.top = `${rect.top}px`;
                        modalContent.style.left = 'auto';
                        modalContent.style.right = `${windowWidth - rect.left + 8}px`;
                    }
                }
            }

            // ë²„íŠ¼ê³¼ ëª¨ë‹¬ ì‚¬ì´ì˜ ì—°ê²° ì˜ì—­ ì„¤ì • (PC/íƒœë¸”ë¦¿ì—ì„œë§Œ)
            if (modalBridge) {
                if (windowWidth > 640) {
                    modalBridge.style.display = 'block';
                    modalBridge.style.top = `${rect.top}px`;
                    modalBridge.style.left = `${rect.right}px`;
                    modalBridge.style.width = '2px';
                    modalBridge.style.height = `${rect.height}px`;
                } else {
                    // ëª¨ë°”ì¼ì—ì„œëŠ” ì—°ê²° ì˜ì—­ ìˆ¨ê¹€
                    modalBridge.style.display = 'none';
                }
            }

            sortModal.classList.remove('hidden');
            // ëª¨ë‹¬ì„ ì—´ ë•Œ ì´ì „ ì„ íƒ ìƒíƒœ ë³µì›
            if (selectedSortValue) {
                setSortSelection(selectedSortValue);
            }
            setTimeout(() => {
                sortModal.classList.remove('opacity-0');
                if (modalContent) {
                    modalContent.classList.remove('scale-95');
                    modalContent.classList.add('scale-100');
                }
            }, 10);
        }

        function closeSortModal() {
            if (!sortModal) return;
            sortModal.classList.add('opacity-0');
            const modalContent = document.getElementById('sort-modal-content');
            const modalBridge = document.getElementById('sort-modal-bridge');
            if (modalContent) {
                modalContent.classList.remove('scale-100');
                modalContent.classList.add('scale-95');
            }
            setTimeout(() => {
                sortModal.classList.add('hidden');
                // ë™ì ìœ¼ë¡œ ì„¤ì •í•œ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™” (ëª¨ë‹¬ì´ ì™„ì „íˆ ìˆ¨ê²¨ì§„ í›„)
                if (modalContent) {
                    modalContent.style.width = '';
                    modalContent.style.top = '';
                    modalContent.style.left = '';
                    modalContent.style.right = '';
                }
                if (modalBridge) {
                    modalBridge.style.display = '';
                }
            }, 300);
        }

        // ì •ë ¬ ë²„íŠ¼ì— click ì´ë²¤íŠ¸ ì¶”ê°€
        if (sortBtn && sortModal) {
            sortBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                // ëª¨ë‹¬ì´ ì´ë¯¸ ì—´ë ¤ìˆìœ¼ë©´ ë‹«ê¸°, ë‹«í˜€ìˆìœ¼ë©´ ì—´ê¸°
                if (sortModal.classList.contains('hidden')) {
                    openSortModal();
                } else {
                    closeSortModal();
                }
            });

            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            document.addEventListener('click', (e) => {
                if (sortModal && !sortModal.classList.contains('hidden')) {
                    const modalContent = document.getElementById('sort-modal-content');
                    const modalBridge = document.getElementById('sort-modal-bridge');
                    if (modalContent && !modalContent.contains(e.target) &&
                        (!modalBridge || !modalBridge.contains(e.target)) &&
                        e.target !== sortBtn && !sortBtn.contains(e.target)) {
                        closeSortModal();
                    }
                }
            });
        }

        // ì •ë ¬ ì˜µì…˜ ì„ íƒ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        if (sortOptionBtns.length > 0) {
            sortOptionBtns.forEach(btn => {
                btn.addEventListener('click', async () => {
                    const selectedSort = btn.dataset.sort;
                    console.log('ì„ íƒëœ ì •ë ¬:', selectedSort);

                    // ì •ë ¬ ë²„íŠ¼ì˜ í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•œ ì •ë ¬ ë°©ì‹ìœ¼ë¡œ ë³€ê²½
                    if (sortBtn) {
                        // ë²„íŠ¼ í¬ê¸° ê³ ì • ìœ ì§€
                        sortBtn.style.minWidth = '73px';
                        sortBtn.style.width = '73px';
                        sortBtn.style.paddingLeft = '6px';
                        sortBtn.style.paddingRight = '4px';

                        // ê¸°ì¡´ ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
                        sortBtn.style.fontSize = '';
                        sortBtn.style.lineHeight = '';
                        sortBtn.style.textAlign = '';
                        sortBtn.className = 'shrink-0 py-2 h-full text-gray-600 text-sm font-bold transition-all flex items-center gap-1';

                        // ì•„ì´ì½˜ì€ í•­ìƒ ê³ ì •, í…ìŠ¤íŠ¸ë§Œ ë³€ê²½
                        const icon = '<i class="fa-solid fa-sort" style="flex-shrink: 0;"></i>';
                        let textContent = '';

                        if (selectedSort === 'reset') {
                            // ì›ë˜ëŒ€ë¡œ
                            textContent = 'ì •ë ¬';
                            selectedSortValue = null;
                            clearSortSelection();

                            // ì •ë ¬ ì´ˆê¸°í™”: í˜„ì¬ ì¹´í…Œê³ ë¦¬ì™€ ê²€ìƒ‰ì–´ ìœ ì§€í•˜ë©´ì„œ ì •ë ¬ë§Œ ì´ˆê¸°í™”
                            const currentCategory = currentCategoryFilter || 'all';
                            const keyword = document.getElementById('search-input') ? document.getElementById('search-input').value : '';
                            currentPage = 1; // 1í˜ì´ì§€ë¡œ ë¦¬ì…‹
                            console.log(`ğŸ”„ ì •ë ¬ ì´ˆê¸°í™”: ì¹´í…Œê³ ë¦¬=${currentCategory}, ê²€ìƒ‰ì–´=${keyword}`);
                            await renderCards(currentCategory, keyword, false, null);
                        } else {
                            // ì„ íƒëœ ì •ë ¬ ì €ì¥
                            selectedSortValue = selectedSort;

                            // ì„ íƒëœ ë²„íŠ¼ì— ìŠ¤íƒ€ì¼ ì ìš©
                            setSortSelection(selectedSort);

                            if (selectedSort === 'latest') {
                                // ìµœì‹ ìˆœ: ê·¸ëŒ€ë¡œ í‘œì‹œ
                                textContent = 'ìµœì‹ ìˆœ';
                            } else if (selectedSort === 'popular') {
                                // ì¸ê¸°ìˆœ: ê·¸ëŒ€ë¡œ í‘œì‹œ
                                textContent = 'ì¸ê¸°ìˆœ';
                            } else if (selectedSort === 'deadline') {
                                // ë§ˆê°ìˆœ: ê·¸ëŒ€ë¡œ í‘œì‹œ
                                textContent = 'ë§ˆê°ìˆœ';
                            }
                        }

                        // ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ë¥¼ ë¶„ë¦¬í•˜ì—¬ ì•„ì´ì½˜ ìœ„ì¹˜ ê³ ì •, í…ìŠ¤íŠ¸ ì˜ì—­ í¬ê¸° ê³ ì • (3ê¸€ì)
                        sortBtn.innerHTML = `${icon} <span class="sort-text" style="display: inline-block; width: 3ch; text-align: left; flex: 1;">${textContent}</span>`;
                    }

                    // ì •ë ¬ ì ìš©: í˜„ì¬ í•„í„°ì™€ ê²€ìƒ‰ì–´ ìœ ì§€í•˜ë©´ì„œ ì •ë ¬ë§Œ ë³€ê²½
                    const currentCategory = currentCategoryFilter || 'all'; // ì €ì¥ëœ ì¹´í…Œê³ ë¦¬ í•„í„° ì‚¬ìš©
                    const keyword = document.getElementById('search-input') ? document.getElementById('search-input').value : '';
                    const sortToApply = selectedSort === 'reset' ? null : selectedSort;

                    // ì •ë ¬ ë³€ê²½ ì‹œ 1í˜ì´ì§€ë¡œ ë¦¬ì…‹
                    currentPage = 1;

                    console.log(`ğŸ”€ ì •ë ¬ ì ìš©: ì¹´í…Œê³ ë¦¬=${currentCategory}, ì •ë ¬=${sortToApply}, ê²€ìƒ‰ì–´=${keyword}`);

                    await renderCards(currentCategory, keyword, false, sortToApply);

                    closeSortModal();
                });
            });
        }
    </script>
    <!-- policy-modal -->
    {% include "components/policy_modal.html" %}
    <script src="/static/policy_modal.js"></script>
</body>

</html>