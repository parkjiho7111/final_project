# 260106 병합 수정 로그

## 오류 1: Uncaught SyntaxError (Identifier 'tinderData' has already been declared)

### 상태
- [x] 분석 완료
- [x] 해결책 제안 완료
- [x] 수정 완료

### 로그
- 분석 시작.
- `static/script.js` 파일에서 `tinderData` 변수가 `const`로 선언되어 있음을 확인.
- `templates/main.html` 파일에서 `static/script.js`가 두 번 포함된 것을 발견:
    1. 300번 줄: `<script src="/static/script.js"></script>` (`<body>` 태그 내부)
    2. 318번 줄: `<script src="/static/script.js"></script>` (`</html>` 태그 이후)
- **원인**: 스크립트가 두 번 로드되면서 이미 선언된 `const` 변수를 다시 선언하려다 SyntaxError 발생.
- **해결**: `templates/main.html` 파일의 318번 줄에 있는 중복된 스크립트 태그 삭제.

## 오류 2: 마이페이지 '찜한 정책' 데이터 표시 오류

### 상태
- [x] 분석 완료
- [x] 해결책 제안 완료
- [x] 수정 완료

### 로그
- 분석 시작.
- 사용자 리포트: 마이페이지의 "내가 찜한 정책" 목록에서 정책 제목이 잘못 나오거나 카테고리가 "기타"로 표시됨.
- **분석**:
    - `static/script.js`의 `createCardHTML` 함수는 `genre`, `summary`, `period` 키값을 기대함.
    - `routers/mypage.py`의 `/api/mypage/likes` API는 `category`, `desc`, `date` 키값을 반환하고 있었음.
    - 키값 불일치로 인해 데이터가 `undefined`가 되어 기본값("기타")으로 표시됨.
- **해결**: `routers/mypage.py`의 API 반환 키값을 프론트엔드(`script.js`) 스펙에 맞게 수정.
    - `desc` -> `summary`
    - `category` -> `genre`
    - `date` -> `period`

<<<<<<< HEAD
## 오류 3: 전체 정책 보기 모달 로직 복구 (참조: 60_all_policy_modal.md)

### 상태
- [x] 분석 완료
- [x] 해결책 제안 완료
- [x] 수정 완료

### 로그
- 분석 시작.
- 사용자 리포트: 병합 과정에서 `60_all_policy_modal.md`에 정의된 모달 기능이 유실됨 (새 창으로 열림).
- `templates/all.html` 확인 결과, 모달 로직이 누락되어 있음을 확인.
- **해결**:
    1.  `all.html`의 `renderCards` 함수 수정:
        - `itemJson` 생성 방식을 `encodeURIComponent`에서 `JSON.stringify(...).replace(...)`로 변경 (따옴표 오류 방지).
        - 클릭 이벤트(`onclick`)를 `window.open`에서 `openCardModal`로 변경.
    2.  `</body>` 태그 직전에 모달 컴포넌트(`policy_modal.html`)와 스크립트(`policy_modal.js`) 포함 코드 추가.

## 오류 4: 마이페이지 모달 '찜' 상태 미반영

### 상태
- [x] 분석 완료
- [x] 해결책 제안 완료
- [x] 수정 완료

### 로그
- 분석 시작.
- 사용자 리포트: 마이페이지에서 찜한 정책을 눌러 모달을 띄웠을 때, 하트 아이콘이 빨간색(찜 상태)으로 표시되지 않음.
- **분석 1**:
    - `script.js`에 `window.openCardModal` 함수가 중복 정의되어 있었음 (기능이 부족한 구 버전).
    - **수정 1**: `script.js`의 중복 함수를 삭제하고 `policy_modal.js`의 함수를 사용하도록 처리.
- **분석 2 (추가)**:
    - 여전히 해결되지 않음.
    - `static/script.js`의 `createCardHTML` 함수가 모달에 전달하는 데이터(`modalData`)에 **정책 ID(`id`)**가 누락된 것을 발견.
    - 서버의 찜 상태 확인 API(`/api/mypage/check`)는 `policy_id`가 필수이므로, ID가 없어서 확인 실패.
- **해결 2**:
    - `static/script.js`의 `createCardHTML` 함수를 수정하여 `modalData` 객체에 `id: item.id`를 포함시키도록 변경.

## 오류 5: 모달 열림 시 화면 덜컹거림 (Layout Shift)

### 상태
- [x] 분석 완료
- [x] 해결책 제안 완료
- [x] 수정 완료

### 로그
- **문제점**: 모달이 열릴 때 우측 스크롤바가 사라지면서 화면 컨텐츠가 오른쪽으로 튀는 현상(Layout Shift) 발생.
- **원인**: `static/policy_modal.js` 파일에서 모달을 열 때 `document.body.style.overflow = 'hidden'`을 설정하여 스크롤바를 강제로 숨기고 있었음.
- **해결**:
    - `static/policy_modal.js` 파일에서 `document.body.style.overflow = 'hidden'` 코드 주석 처리.
    - 모달 닫을 때의 복구 코드도 함께 주석 처리.

---

## 🔬 테스트 계획 (Test Plan)

수정 사항이 올바르게 적용되었는지 확인하기 위한 테스트 절차입니다. 서버를 실행(`uvicorn main:app --reload`)한 후 진행해주세요.

### 1. 메인 페이지 오류 확인 (오류 1)
=======
## Issue 3: Policy Modal Logic Restoration (Reference: 60_all_policy_modal.md)

### Status
- [x] Analyzing
- [x] Solution Proposed
- [x] Fixed

### Logs
- Started analysis.
- User reported that a previous fix documented in `60_all_policy_modal.md` was lost during the merge.
- Checked `templates/all.html` and confirmed the logic was missing/reverted.
- **Solution**:
    1.  Modified `renderCards` in `all.html`:
        - Changed `encodeURIComponent` to `JSON.stringify(...).replace(...)` for `itemJson`.
        - Changed `onclick` from `window.open` to `openCardModal`.
    2.  Added `{% include "components/policy_modal.html" %}` and `<script src="/static/policy_modal.js"></script>` before `</body>`.

## Issue 4: My Page Modal 'Like' Status Persistence

### Status
- [x] Analyzing
- [x] Solution Proposed
- [x] Fixed

### Logs
- Started analysis.
- User reported that clicking a liked card in My Page opens a modal where the heart icon is not active (not red), failing to reflect the "liked" status.
- **Analysis 1**:
    - Found duplicate `window.openCardModal` in `script.js`.
    - **Fix 1**: Removed duplicate function from `script.js` and exposed the correct one in `policy_modal.js`.
- **Analysis 2 (Follow-up)**:
    - User reported the issue persisted.
    - Found that `createCardHTML` in `static/script.js` was creating a `modalData` object **without the policy ID**.
    - The server check (`/api/mypage/check`) requires `policy_id`. Without it, the check fails (or never happens properly), so the heart remains inactive.
- **Solution**:
    - Updated `createCardHTML` in `static/script.js` to include `id: item.id` in the `modalData` object.

## Issue 5: Layout Shift when opening Modal

### Status
- [x] Analyzing
- [x] Solution Proposed
- [x] Fixed

### Logs
- **Issue**: Checking the "policy_modal" window, the user noticed the screen shifting because the mouse wheel (scrollbar) disappears when the modal opens.
- **Goal**: Keep the scrollbar visible even when the modal is open to prevent layout shift.
- **Analysis**:
    - `static/policy_modal.js` sets `document.body.style.overflow = 'hidden'` when the modal opens. This hides the scrollbar and causes the layout shift.
- **Solution**:
    - Commented out `document.body.style.overflow = 'hidden'` in `static/policy_modal.js`.
    - Commented out the corresponding restoration code in the `closeModal` function.

---

## 🔬 Test Plan

수정 사항이 올바르게 적용되었는지 확인하기 위한 테스트 절차입니다. 서버를 실행(`uvicorn main:app --reload`)한 후 진행해주세요.

### 1. 메인 페이지 오류 확인 (Issue 1)
>>>>>>> 260106_merge_fix
1.  브라우저에서 메인 페이지(`http://localhost:8000/main.html`)에 접속합니다.
2.  `F12`를 눌러 개발자 도구(Console 탭)를 엽니다.
3.  빨간색 에러 메시지 `Uncaught SyntaxError: Identifier 'tinderData' has already been declared`가 **표시되지 않아야 합니다.**
4.  Console에 `🔥 로드된 틴더 데이터:` 등의 로그가 정상적으로 뜨는지 확인합니다.

<<<<<<< HEAD
### 2. 마이페이지 찜한 정책 확인 (오류 2)
=======
### 2. 마이페이지 찜한 정책 확인 (Issue 2)
>>>>>>> 260106_merge_fix
1.  로그인 상태에서 마이페이지(`http://localhost:8000/mypage.html`)에 접속합니다.
2.  **'내가 찜한 정책 ❤️'** 섹션을 확인합니다.
3.  정책 카드의 **카테고리(예: 취업, 주거 등)**가 '기타'가 아닌 올바른 값으로 표시되는지 확인합니다.
4.  제목과 내용이 정상적으로 출력되는지 확인합니다.
    *   *참고: 브라우저 캐시로 인해 이전 스크립트가 로드될 수 있으므로 `Ctrl + Shift + R`로 강력 새로고침을 권장합니다.*

<<<<<<< HEAD
### 3. 전체 정책 보기 모달 확인 (오류 3)
=======
### 3. 전체 정책 보기 모달 확인 (Issue 3)
>>>>>>> 260106_merge_fix
1.  전체 정책 보기 페이지(`http://localhost:8000/all.html`)에 접속합니다.
2.  화면에 보이는 정책 카드 중 아무거나 하나를 클릭합니다.
3.  **새 창이나 새 탭이 열리지 않고**, 화면 중앙에 **상세 정보 모달**이 떠야 합니다.
4.  모달 내의 정보(제목, 내용 등)가 카드 내용과 일치하는지 확인합니다.
5.  모달의 닫기 버튼(X)을 눌러 정상적으로 닫히는지 확인합니다.

<<<<<<< HEAD
### 4. 찜하기 상태 유지 확인 (오류 4)
=======
### 4. 찜하기 상태 유지 확인 (Issue 4)
>>>>>>> 260106_merge_fix
1.  마이페이지(`http://localhost:8000/mypage.html`)에서 '내가 찜한 정책' 카드 중 하나를 클릭해 모달을 엽니다.
2.  모달 우측 하단의 **하트(찜하기) 버튼**이 **빨간색으로 채워져 있는지** 확인합니다.
3.  하트 버튼을 눌러 찜이 취소되는지(회색 하트), 다시 누르면 찜이 되는지 확인합니다.

<<<<<<< HEAD
### 5. 모달 열림 시 스크롤바 유지 확인 (오류 5)
=======
### 5. 모달 열림 시 스크롤바 유지 확인 (Issue 5)
>>>>>>> 260106_merge_fix
1.  정책 카드를 클릭하여 모달을 엽니다.
2.  **화면 우측의 스크롤바가 사라지지 않고 그대로 있는지** 확인합니다.
3.  화면이 덜컹거리는(Layout Shift) 현상이 사라졌는지 확인합니다.
