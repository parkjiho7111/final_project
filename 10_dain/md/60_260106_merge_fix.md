# 260106 Merge Fix Log

## Issue 1: Uncaught SyntaxError: Identifier 'tinderData' has already been declared

### Status
- [x] Analyzing
- [x] Solution Proposed
- [x] Fixed

### Logs
- Started analysis.
- Found that `tinderData` is declared as a `const` in `static/script.js`.
- Found that `templates/main.html` includes `static/script.js` twice:
    1. Line 300: `<script src="/static/script.js"></script>` (Inside `<body>`)
    2. Line 318: `<script src="/static/script.js"></script>` (After `</html>`)
- **Cause**: Redeclaring a `const` variable in the same global scope when the script is loaded a second time causes the SyntaxError.
- **Solution**: Removed the redundant script inclusion at line 318 in `templates/main.html`.

## Issue 2: My Page 'Like' Policies Data Display Issue

### Status
- [x] Analyzing
- [x] Solution Proposed
- [x] Fixed

### Logs
- Started analysis.
- User reported that "My Liked Policies" on My Page display incorrect data (titles differ from actual policies, category shows "ê¸°íƒ€") after merging `all.html` and `main.html`.
- **Analysis**:
    - The `createCardHTML` function in `static/script.js` expects keys: `genre`, `summary`, `period`.
    - The `/api/mypage/likes` endpoint in `routers/mypage.py` returns keys: `category`, `desc`, `date`.
    - Discrepancy causes `displayGenre` to fallback to "ê¸°íƒ€".
- **Solution**: Updated `routers/mypage.py` to return JSON with keys matching `script.js` expectations.
    - `desc` -> `summary`
    - `category` -> `genre`
    - `date` -> `period`

## Issue 3: Policy Modal Logic Restoration (Reference: 60_all_policy_modal.md)

### Status
- [x] Analyzing
- [x] Solution Proposed
- [x] Fixed

### Logs
- Started analysis.
- User reported that a previous fix documented in `60_all_policy_modal.md` was lost during the merge.
- Checked `templates/all.html` and confirmed the logic was missing/reverted.
- **Solution**:
    1.  Modified `renderCards` in `all.html`:
        - Changed `encodeURIComponent` to `JSON.stringify(...).replace(...)` for `itemJson`.
        - Changed `onclick` from `window.open` to `openCardModal`.
    2.  Added `{% include "components/policy_modal.html" %}` and `<script src="/static/policy_modal.js"></script>` before `</body>`.

## Issue 4: My Page Modal 'Like' Status Persistence

### Status
- [x] Analyzing
- [x] Solution Proposed
- [x] Fixed

### Logs
- Started analysis.
- User reported that clicking a liked card in My Page opens a modal where the heart icon is not active (not red), failing to reflect the "liked" status.
- **Analysis 1**:
    - Found duplicate `window.openCardModal` in `script.js`.
    - **Fix 1**: Removed duplicate function from `script.js` and exposed the correct one in `policy_modal.js`.
- **Analysis 2 (Follow-up)**:
    - User reported the issue persisted.
    - Found that `createCardHTML` in `static/script.js` was creating a `modalData` object **without the policy ID**.
    - The server check (`/api/mypage/check`) requires `policy_id`. Without it, the check fails (or never happens properly), so the heart remains inactive.
- **Solution**:
    - Updated `createCardHTML` in `static/script.js` to include `id: item.id` in the `modalData` object.

## Issue 5: Layout Shift when opening Modal

### Status
- [x] Analyzing
- [x] Solution Proposed
- [x] Fixed

### Logs
- **Issue**: Checking the "policy_modal" window, the user noticed the screen shifting because the mouse wheel (scrollbar) disappears when the modal opens.
- **Goal**: Keep the scrollbar visible even when the modal is open to prevent layout shift.
- **Analysis**:
    - `static/policy_modal.js` sets `document.body.style.overflow = 'hidden'` when the modal opens. This hides the scrollbar and causes the layout shift.
- **Solution**:
    - Commented out `document.body.style.overflow = 'hidden'` in `static/policy_modal.js`.
    - Commented out the corresponding restoration code in the `closeModal` function.

---

## ğŸ”¬ Test Plan

ìˆ˜ì • ì‚¬í•­ì´ ì˜¬ë°”ë¥´ê²Œ ì ìš©ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•œ í…ŒìŠ¤íŠ¸ ì ˆì°¨ì…ë‹ˆë‹¤. ì„œë²„ë¥¼ ì‹¤í–‰(`uvicorn main:app --reload`)í•œ í›„ ì§„í–‰í•´ì£¼ì„¸ìš”.

### 1. ë©”ì¸ í˜ì´ì§€ ì˜¤ë¥˜ í™•ì¸ (Issue 1)
1.  ë¸Œë¼ìš°ì €ì—ì„œ ë©”ì¸ í˜ì´ì§€(`http://localhost:8000/main.html`)ì— ì ‘ì†í•©ë‹ˆë‹¤.
2.  `F12`ë¥¼ ëˆŒëŸ¬ ê°œë°œì ë„êµ¬(Console íƒ­)ë¥¼ ì—½ë‹ˆë‹¤.
3.  ë¹¨ê°„ìƒ‰ ì—ëŸ¬ ë©”ì‹œì§€ `Uncaught SyntaxError: Identifier 'tinderData' has already been declared`ê°€ **í‘œì‹œë˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤.**
4.  Consoleì— `ğŸ”¥ ë¡œë“œëœ í‹´ë” ë°ì´í„°:` ë“±ì˜ ë¡œê·¸ê°€ ì •ìƒì ìœ¼ë¡œ ëœ¨ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

### 2. ë§ˆì´í˜ì´ì§€ ì°œí•œ ì •ì±… í™•ì¸ (Issue 2)
1.  ë¡œê·¸ì¸ ìƒíƒœì—ì„œ ë§ˆì´í˜ì´ì§€(`http://localhost:8000/mypage.html`)ì— ì ‘ì†í•©ë‹ˆë‹¤.
2.  **'ë‚´ê°€ ì°œí•œ ì •ì±… â¤ï¸'** ì„¹ì…˜ì„ í™•ì¸í•©ë‹ˆë‹¤.
3.  ì •ì±… ì¹´ë“œì˜ **ì¹´í…Œê³ ë¦¬(ì˜ˆ: ì·¨ì—…, ì£¼ê±° ë“±)**ê°€ 'ê¸°íƒ€'ê°€ ì•„ë‹Œ ì˜¬ë°”ë¥¸ ê°’ìœ¼ë¡œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
4.  ì œëª©ê³¼ ë‚´ìš©ì´ ì •ìƒì ìœ¼ë¡œ ì¶œë ¥ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
    *   *ì°¸ê³ : ë¸Œë¼ìš°ì € ìºì‹œë¡œ ì¸í•´ ì´ì „ ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë“œë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ `Ctrl + Shift + R`ë¡œ ê°•ë ¥ ìƒˆë¡œê³ ì¹¨ì„ ê¶Œì¥í•©ë‹ˆë‹¤.*

### 3. ì „ì²´ ì •ì±… ë³´ê¸° ëª¨ë‹¬ í™•ì¸ (Issue 3)
1.  ì „ì²´ ì •ì±… ë³´ê¸° í˜ì´ì§€(`http://localhost:8000/all.html`)ì— ì ‘ì†í•©ë‹ˆë‹¤.
2.  í™”ë©´ì— ë³´ì´ëŠ” ì •ì±… ì¹´ë“œ ì¤‘ ì•„ë¬´ê±°ë‚˜ í•˜ë‚˜ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
3.  **ìƒˆ ì°½ì´ë‚˜ ìƒˆ íƒ­ì´ ì—´ë¦¬ì§€ ì•Šê³ **, í™”ë©´ ì¤‘ì•™ì— **ìƒì„¸ ì •ë³´ ëª¨ë‹¬**ì´ ë– ì•¼ í•©ë‹ˆë‹¤.
4.  ëª¨ë‹¬ ë‚´ì˜ ì •ë³´(ì œëª©, ë‚´ìš© ë“±)ê°€ ì¹´ë“œ ë‚´ìš©ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
5.  ëª¨ë‹¬ì˜ ë‹«ê¸° ë²„íŠ¼(X)ì„ ëˆŒëŸ¬ ì •ìƒì ìœ¼ë¡œ ë‹«íˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

### 4. ì°œí•˜ê¸° ìƒíƒœ ìœ ì§€ í™•ì¸ (Issue 4)
1.  ë§ˆì´í˜ì´ì§€(`http://localhost:8000/mypage.html`)ì—ì„œ 'ë‚´ê°€ ì°œí•œ ì •ì±…' ì¹´ë“œ ì¤‘ í•˜ë‚˜ë¥¼ í´ë¦­í•´ ëª¨ë‹¬ì„ ì—½ë‹ˆë‹¤.
2.  ëª¨ë‹¬ ìš°ì¸¡ í•˜ë‹¨ì˜ **í•˜íŠ¸(ì°œí•˜ê¸°) ë²„íŠ¼**ì´ **ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ì±„ì›Œì ¸ ìˆëŠ”ì§€** í™•ì¸í•©ë‹ˆë‹¤.
3.  í•˜íŠ¸ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì°œì´ ì·¨ì†Œë˜ëŠ”ì§€(íšŒìƒ‰ í•˜íŠ¸), ë‹¤ì‹œ ëˆ„ë¥´ë©´ ì°œì´ ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

### 5. ëª¨ë‹¬ ì—´ë¦¼ ì‹œ ìŠ¤í¬ë¡¤ë°” ìœ ì§€ í™•ì¸ (Issue 5)
1.  ì •ì±… ì¹´ë“œë¥¼ í´ë¦­í•˜ì—¬ ëª¨ë‹¬ì„ ì—½ë‹ˆë‹¤.
2.  **í™”ë©´ ìš°ì¸¡ì˜ ìŠ¤í¬ë¡¤ë°”ê°€ ì‚¬ë¼ì§€ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ìˆëŠ”ì§€** í™•ì¸í•©ë‹ˆë‹¤.
3.  í™”ë©´ì´ ëœì»¹ê±°ë¦¬ëŠ”(Layout Shift) í˜„ìƒì´ ì‚¬ë¼ì¡ŒëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
